var e=Object.defineProperty,t=(t,r,o)=>((t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o)(t,"symbol"!=typeof r?r+"":r,o);import{jsx as r,jsxs as o,Fragment as n}from"react/jsx-runtime";import i,{createContext as a,useState as s,useCallback as l,useMemo as c,useEffect as d,memo as h,useRef as g,useContext as u,useLayoutEffect as m}from"react";import p from"react-dom/server";import{motion as f,useAnimation as v,useViewportScroll as w,useTransform as y}from"framer-motion";import b from"yet-another-react-lightbox";import _ from"yet-another-react-lightbox/plugins/captions";import x from"yet-another-react-lightbox/plugins/counter";import I from"yet-another-react-lightbox/plugins/thumbnails";import C from"yet-another-react-lightbox/plugins/zoom";import k from"gsap";import{CustomEase as N}from"gsap/CustomEase.js";import{ScrollTrigger as M}from"gsap/ScrollTrigger.js";import{useVirtualizer as P}from"@tanstack/react-virtual";import{FastAverageColor as S}from"fast-average-color";import R from"lodash/debounce.js";import{useQuery as $}from"@tanstack/react-query";import E from"axios";import{openDB as T}from"idb";import F from"react-slick";import{FaChevronRight as L,FaChevronLeft as A,FaHome as H}from"react-icons/fa";import z from"react-masonry-css";import{IconFolder as q}from"@tabler/icons-react";import{ScrollToPlugin as W}from"gsap/ScrollToPlugin.js";const B="_imageViewer_feuzf_1",j="_contentContainer_feuzf_8",D={imageGrid:"_imageGrid_162y8_2",myMasonryGrid:"_myMasonryGrid_162y8_18",myMasonryGridColumn:"_myMasonryGridColumn_162y8_23",imageWrapper:"_imageWrapper_162y8_28",image:"_image_162y8_2",imageTitle:"_imageTitle_162y8_44",smoothTransition:"_smoothTransition_162y8_49",imageFeed:"_imageFeed_162y8_54",imageRow:"_imageRow_162y8_60",visible:"_visible_162y8_65",parallaxLayer:"_parallaxLayer_162y8_92","masked-image-feed":"_masked-image-feed_162y8_101","image-feed":"_image-feed_162y8_108",feedContent:"_feedContent_162y8_140",waterMask:"_waterMask_162y8_148",ripple:"_ripple_162y8_158",rippleOverlay:"_rippleOverlay_162y8_167",container:"_container_162y8_185",feed:"_feed_162y8_140",fadeIn:"_fadeIn_162y8_1",gridContainer:"_gridContainer_162y8_199",loading:"_loading_162y8_205",noImages:"_noImages_162y8_212",imageFeedContainer:"_imageFeedContainer_162y8_228"};var U=(e=>(e.GRID="grid",e.BANNER="banner",e.MASONRY="masonry",e.CAROUSEL="carousel",e))(U||{});function G(e){if(!e)return"Untitled";const t=e.replace(/\.(preview|thumbnail|jpg|jpeg|png|gif|webp)/gi,"").replace(/[-_.](v\d+|example|intro|concept)[-_.]?\d*/gi,"").replace(/[-_.]?(flux|lora|ai|toolkit|preview|example\d*|poster)[-_.]?/gi," ").replace(/\.\d+$/,"").replace(/[-_.]?\d{6,}[-_.]?/g,"").replace(/(\d)[-_.](\d)/g,"$1$2").replace(/\s+\d+$/,"").replace(/[-_.]+/g," ").replace(/\s+/g," ").split(" ").map((e=>e.match(/^[A-Z]{2,}$/)?e:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" ").trim();return t.length>30?t.substring(0,30)+"...":t}const O="_imageRow_1tgys_1",V="_imageWrapper_1tgys_26",Q="#041024",Z={isHovering:!1,position:null,color:null},Y=a({dominantColors:[Q],setDominantColors:()=>{},hoverState:Z,setHoverState:()=>{}}),K=({children:e})=>{const[t,o]=s([Q]),[n,i]=s(Z),a=l((e=>{i((t=>({...t,...e})))}),[]),d=c((()=>({dominantColors:t,setDominantColors:o,hoverState:n,setHoverState:a})),[t,n,a]);return r(Y.Provider,{value:d,children:e})},X={imageContainer:"_imageContainer_1tb1b_1",imageWrapper:"_imageWrapper_1tb1b_17",image:"_image_1tb1b_1",imageTitle:"_imageTitle_1tb1b_38",groupCounter:"_groupCounter_1tb1b_57",carouselIndicator:"_carouselIndicator_1tb1b_75",loading:"_loading_1tb1b_96",shimmer:"_shimmer_1tb1b_1",imageItem:"_imageItem_1tb1b_107",imageSkeleton:"_imageSkeleton_1tb1b_121",gradientBG:"_gradientBG_1tb1b_1",skeletonGridContainer:"_skeletonGridContainer_1tb1b_143"};k.registerPlugin(M);const J=class e{constructor(){t(this,"targets",new Map),t(this,"timeline"),t(this,"mainTrigger"),this.timeline=k.timeline({paused:!0,smoothChildTiming:!0}),this.mainTrigger=M.create({trigger:document.body,start:"top top",end:"bottom bottom",onUpdate:e=>{this.timeline.progress(e.progress)},markers:!1})}static getInstance(){return e.instance||(e.instance=new e),e.instance}addAnimation(e,t,r){const o=k.to(t,{...r,paused:!0});return this.timeline.add(o,0),this.targets.set(e,{element:t,animation:o}),o}removeAnimation(e){const t=this.targets.get(e);t&&(this.timeline.remove(t.animation),this.targets.delete(e))}cleanup(){this.targets.forEach((({animation:e})=>{e.kill()})),this.mainTrigger&&this.mainTrigger.kill(),this.timeline.kill(),this.targets.clear(),M.getAll().forEach((e=>e.kill()))}};t(J,"instance");let ee=J;k.registerPlugin(M,N);const te=class e{constructor(){t(this,"scrollTriggerManager"),this.initializeCustomEases(),this.scrollTriggerManager=ee.getInstance()}initializeCustomEases(){N.create("smoothOut","M0,0 C0.126,0.382 0.282,0.674 0.44,0.822 0.632,1.002 0.818,1 1,1"),N.create("gentleIn","M0,0 C0.39,0 0.575,0.565 0.669,0.782 0.762,1 0.846,1 1,1")}static getInstance(){return e.instance||(e.instance=new e),e.instance}getAnimationProperties(e){return{duration:.5,ease:"power2.out",transformOrigin:"center center",scale:1,rotation:0}}createHoverAnimation(e,t){return k.to(e,{scale:1.05,duration:.3,ease:"power2.out",force3D:!0})}createMorphAnimation(e,t){return k.to(e,{duration:.5,borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",ease:"power2.out",force3D:!0})}createScrollAnimation(e,t,r){return this.scrollTriggerManager.addAnimation(t,e,r)}};t(te,"instance");let re=te;const oe=i.forwardRef((({src:e,alt:t,width:o,isProcessed:n,onLoad:i,onError:a,className:c,style:h},g)=>{const[u,m]=s(!1);d((()=>{m(!1)}),[e]);const p=l((()=>{m(!0),i()}),[i]),v=l((()=>{m(!1),a()}),[a]),w=!n&&o&&!e.startsWith("blob:"),y=w?[`${e}&w=${Math.round(o)} 1x`,`${e}&w=${Math.round(2*o)} 2x`,`${e}&w=${Math.round(3*o)} 3x`].join(", "):void 0,b=w?`${Math.round(o)}px`:void 0;return r(f.img,{ref:g,src:e,alt:t,className:c,loading:"lazy",style:{display:"block",width:"100%",height:"100%",objectFit:"cover",position:"absolute",top:0,left:0,...h},initial:{opacity:0},animate:{opacity:u?1:0},transition:{duration:.4,ease:"easeIn"},onLoad:p,onError:v,srcSet:y,sizes:b},e)}));oe.displayName="ResponsiveImage";const ne=h((({image:e,onClick:t,containerWidth:n,containerHeight:i,zoom:a=1,groupCount:h,workerPool:m,onResize:p,width:f,height:v,isCarousel:w=!1,groupImages:y=[],onImageHover:b,onImageLoadError:_})=>{const x=g(null),I=g(null),[C,k]=s(!1),[N,M]=s({});c((()=>re.getInstance()),[]),u(Y);const[P,S]=s(!1),R=g(!1),[$,E]=s(!1),[T,F]=s(!1),[L,A]=s(!1),H=c((()=>"#333"),[e.id]),z=n,q=i,W=c((()=>e.width&&e.height&&e.width>0&&e.height>0?`${e.width} / ${e.height}`:z>0&&q>0?`${z} / ${q}`:"1 / 1"),[e.width,e.height,z,q]);d((()=>{p&&p(z,q)}),[z,q,p]);const B=l((()=>{if(I.current){const t=I.current.getBoundingClientRect(),r=t.left+t.width/2,o=t.top+t.height/2,n=r/window.innerWidth,i=o/window.innerHeight;b({isHovering:!0,position:{x:n,y:i},color:null,imageId:e.id})}}),[b,e.id]),j=l((()=>{console.log("[ImageItem Hover Leave]"),b({isHovering:!1,position:null,color:null,imageId:e.id})}),[b,e.id]),D=l((t=>{t.id===e.id&&(M((e=>({...e,[t.quality]:t.processedImage}))),"low"===t.quality&&F(!0),"high"===t.quality&&A(!0))}),[e.id]);d((()=>{const t=new IntersectionObserver((([t])=>{if(S(t.isIntersecting),t.isIntersecting)if(!R.current&&z>0&&q>0){m.getImageProcessor().requestImageProcessing({id:e.id,src:e.src,width:z,height:q},D),R.current=!0}else R.current}),{root:null,rootMargin:"300px",threshold:0}),r=I.current;return r&&t.observe(r),()=>{r&&t.unobserve(r)}}),[e.id,e.src,m,z,q,D]),d((()=>()=>{const t=N.low,r=N.high;t&&(console.log(`[ImageItem ${e.id}] Revoking low-res blob URL on unmount: ${t}`),URL.revokeObjectURL(t)),r&&(console.log(`[ImageItem ${e.id}] Revoking high-res blob URL on unmount: ${r}`),URL.revokeObjectURL(r))}),[]);const U=c((()=>N.high?N.high:N.low?N.low:e.src),[N.high,N.low,e.src]),O=!(!N.high&&!N.low),V=T||L||!$&&U,Q=l((()=>{(N.high||!T&&!L)&&k(!0),E(!1)}),[N.high,T,L]),Z=l((()=>{E(!0),_(e.id)}),[e.id,_]);return c((()=>G(e.alt||e.title||"Untitled")),[e.alt,e.title]),$?null:o("div",{ref:I,className:X.imageItemContainer,onClick:()=>!$&&t(e),onMouseEnter:B,onMouseLeave:j,style:{width:`${z}px`,height:`${q}px`,aspectRatio:W,position:"relative",overflow:"hidden",cursor:$?"not-allowed":"pointer",backgroundColor:H},children:[V&&r(oe,{ref:x,src:U,alt:e.alt||e.id,width:z,isProcessed:O,onLoad:Q,onError:Z,className:X.imageElement},U),$&&r("div",{className:X.errorOverlay,children:r("span",{children:"Error"})}),r("div",{className:X.titleOverlay,children:G(e.alt||e.id)}),h&&h>1&&r("div",{className:X.groupIndicator,children:h})]})})),ie={type:"spring",stiffness:120,damping:30,mass:1},ae={hidden:{opacity:0,scale:.95},visible:e=>({opacity:1,scale:1,transition:{delay:.03*e,duration:.3,ease:"easeOut"}})},se=i.memo((({images:e,imageWidths:t,onImageClick:o,columns:n,zoom:i,isLastRow:a,rowHeight:s,groupedImages:l,workerPool:c,gap:d,containerWidth:h,onImageHover:u,onImageLoadError:m})=>{const p=g(null),w=v();return!e||0===e.length||!t||t.length!==e.length||s<=0?null:r(f.div,{ref:p,className:O,animate:w,initial:!1,style:{display:"flex",flexWrap:"nowrap",overflow:"hidden",gap:`${d}px`,height:`${s}px`,marginBottom:`${d}px`,position:"relative",willChange:"transform",width:"100%",maxWidth:`${h}px`,justifyContent:"flex-start",alignItems:"stretch"},layout:!0,transition:ie,children:e.map(((e,n)=>{const a=l.find((t=>t.images.some((t=>t.id===e.id)))),d=t[n];return void 0===d||d<=0?(console.warn(`Invalid width (${d}) calculated for image ${e.id} at index ${n}`),null):r(f.div,{className:V,custom:n,initial:"hidden",animate:"visible",variants:ae,style:{width:`${d}px`,height:`${s}px`,flexShrink:0,flexGrow:0,position:"relative",overflow:"hidden"},layout:!0,transition:ie,children:r(ne,{image:e,onClick:()=>o(e),containerWidth:d,containerHeight:s,width:d,height:s,zoom:i,isCarousel:(null==a?void 0:a.isCarousel)||!1,groupImages:(null==a?void 0:a.images)||[],workerPool:c,onImageHover:u,onImageLoadError:m})},e.id)}))})})),le=({containerWidth:e,containerHeight:t})=>r("div",{className:`${X.imageItem} ${X.imageSkeleton}`,style:{width:e,height:t,maxWidth:"100%",maxHeight:"100%",aspectRatio:`${e} / ${t}`},children:r("div",{className:X.skeletonAnimation})}),ce=E.create({baseURL:"/api"});async function de(){try{return(await ce.get("/folders")).data.map((e=>({name:e.name,path:e.path})))}catch(e){throw console.error("Error in getFolders:",e),new Error("Failed to fetch folders")}}async function he(){try{return(await ce.get("/getCurrentDirectory")).data.currentDirectory}catch(e){throw console.error("Error in getCurrentDirectory:",e),new Error("Failed to get current directory")}}function ge(e){return $({queryKey:["images",e],queryFn:()=>async function(e){var t;if(!e)throw new Error("Folder parameter is required");try{const t=await ce.get(`/images?folder=${encodeURIComponent(e)}`);if(!Array.isArray(t.data))throw console.error("Invalid response data:",t.data),new Error("Invalid response format from server");return t.data}catch(r){if(r.response){const e=(null==(t=r.response.data)?void 0:t.error)||r.response.statusText;throw new Error(`Server error: ${e}`)}throw r.request?new Error("No response from server"):(console.error("Error in getImages:",r),new Error(r.message||"Failed to fetch images"))}}(e),enabled:!!e,placeholderData:e=>e})}const ue="scrollPosition";let me=null;function pe(){return me||(me=T("mediaFlowUIScrollDB",1,{upgrade(e){e.objectStoreNames.contains(ue)||e.createObjectStore(ue)}})),me}async function fe(e,t){try{const r=(await pe()).transaction(ue,"readwrite"),o=r.objectStore(ue),n={scrollTop:t,timestamp:Date.now()};await o.put(n,e),await r.done}catch(r){console.error("Failed to save scroll state for path:",e,r)}}const ve=200,we=new WeakMap,ye=new Map,be=e=>{const t=4*(1+.25*((Math.max(.5,Math.min(3,e))-.5)/2.5)),r=Math.round(2*t)/2;return Math.min(Math.max(r,2),12)},_e=e=>{let t=we.get(e);return t||(t=e.width/e.height,we.set(e,t)),t},xe=(e,t,r,o)=>{const n=(e=>e.map(_e))(e),i=n.reduce(((e,t)=>e+t),0),a=Math.max(0,(e.length-1)*o),s=Math.max(0,t-a)/i,l=n.map((e=>Math.floor(s*e)));return{idealHeight:s,widths:l}},Ie=(e,t,r,o)=>{const{idealHeight:n,widths:i}=xe(e,t,0,o),a=ve*r,s=i.every((e=>e>=a)),l=i.reduce(((e,t)=>e+t),0)+(e.length-1)*o;return{fits:s&&l<=t,idealHeight:n,predictedWidths:i}},Ce=(e,t,r,o=200)=>{if(t<=0||0===e.length)return console.warn("Invalid input detected"),[];const n=(e=>{const t=e.map((e=>e.id)).join(",");if(ye.has(t))return ye.get(t);const r=[...e].sort(((e,t)=>e.width/e.height-t.width/t.height));return ye.set(t,r),r})(e),i=be(r),a=[];let s=[],l=0;for(let c=0;c<n.length;c++){const e=[...s,n[c]],{fits:o,idealHeight:d,predictedWidths:h}=Ie(e,t,r,i);if(!o&&s.length>0){const{idealHeight:e,widths:r}=xe(s,t,0,i),o=Math.floor(e),d=Math.max(0,(s.length-1)*i);let h=0;const g=s.map(((e,t)=>{const r=Math.floor(_e(e)*o);return h+=r,r})),u=t-d-h;0!==u&&g.length>0&&(g[g.length-1]+=u),a.push({width:t,height:o,gap:i,images:s,imageWidths:g,offset:0}),s=[n[c]],l=_e(n[c])}else s=e,l+=_e(n[c])}if(s.length>0){const{idealHeight:e,widths:r}=xe(s,t,0,i),o=Math.floor(e),n=Math.max(0,(s.length-1)*i);let l=0;const c=s.map(((e,t)=>{const r=Math.floor(_e(e)*o);return l+=r,r})),d=t-n-l;0!==d&&c.length>0&&(c[c.length-1]+=d),a.push({width:t,height:o,gap:i,images:s,imageWidths:c,offset:0})}return a},ke=e=>{const{containerWidth:t,zoom:r,viewMode:o,isGrouped:n}=e,i=((e,t)=>{const r=e/t,o=Math.floor(r/(ve*t));return Math.min(Math.max(o,1),7)})(t,r),a=be(r);return{columns:i,gap:a,minImageWidth:ve*r,maxImageWidth:t/i-a}},Ne=(e,t,r,o,n=.25)=>{if(void 0===e||void 0===t||r<=0||o<=0)return!0;const i=Math.abs(e-r)/r,a=Math.abs(t-o)/o;return i>n||a>n};class Me{constructor(){t(this,"worker"),t(this,"db",null),t(this,"requestQueue",[]),t(this,"isProcessing",!1),t(this,"isWorkerCancelled",!1),t(this,"callbacks",new Map),this.worker=new Worker(new URL("./imageProcessorWorker.ts",import.meta.url)),this.initDB(),this.worker.onmessage=this.handleWorkerMessage.bind(this),this.worker.onerror=e=>{console.error("Error in ImageProcessorWorker:",e),this.isProcessing=!1,this.processNextRequest()}}async initDB(){var e,t;try{if(this.db=await T("imageCache",1,{upgrade(e){e.objectStoreNames.contains("processedImages")||e.createObjectStore("processedImages",{keyPath:"id"})}}),this.db){console.log("ImageProcessor: Checking cache for stale blob URLs...");const r=this.db.transaction("processedImages","readwrite"),o=r.objectStore("processedImages");let n=await o.openCursor(),i=0;for(;n;){const r=n.value,o=null==(e=r.low)?void 0:e.startsWith("blob:"),a=null==(t=r.high)?void 0:t.startsWith("blob:");(o||a)&&(await n.delete(),i++),n=await n.continue()}await r.done,i>0?console.log(`ImageProcessor: Removed ${i} stale cache entries.`):console.log("ImageProcessor: No stale blob URLs found in cache.")}}catch(r){console.error("Failed to initialize IndexedDB for image cache:",r),this.db=null}}async getCachedImageData(e){if(!this.db)return null;try{return await this.db.get("processedImages",e)??null}catch(t){return console.error(`Failed to get cached image data for ${e}:`,t),null}}async cacheImageData(e,t,r,o,n){if(this.db)try{const i=this.db.transaction("processedImages","readwrite"),a=i.objectStore("processedImages"),s={...await a.get(e)||{},id:e,width:o,height:n,[t]:r};await a.put(s),await i.done}catch(i){console.error(`Failed to cache image data for ${e} (${t}):`,i)}}async processNextRequest(){if(this.isProcessing||0===this.requestQueue.length)return;this.isProcessing=!0;const e=this.requestQueue.shift();if(this.isWorkerCancelled&&"image"!==e.type&&"batch"!==e.type)return console.log("ImageProcessor: Worker cancelled, skipping non-processing request."),this.isProcessing=!1,void this.processNextRequest();"image"===e.type?(this.isWorkerCancelled=!1,await this.processImageRequest(e.payload,e.callback)):"batch"===e.type&&(this.isWorkerCancelled=!1,await this.processBatchRequest(e.payload,e.callback)),this.isProcessing=!1,setTimeout((()=>this.processNextRequest()),0)}async processImageRequest(e,t){const{id:r,src:o,width:n,height:i}=e,a=await this.getCachedImageData(r);let s=!0,l="No cache found";if(a)if(a.high){!Ne(a.width,a.height,n,i)?(s=!1,l="Cache hit (matching dimensions)",console.log(`ImageProcessor: Cache hit for ${r} with matching dimensions.`),t&&(a.low&&t({id:r,quality:"low",processedImage:a.low}),t({id:r,quality:"high",processedImage:a.high}))):(s=!0,l="Cache found but dimensions mismatch",console.log(`ImageProcessor: Cache found for ${r} but dimensions mismatch. Requesting re-processing.`))}else s=!0,l="Cache found but high-res missing",console.log(`ImageProcessor: Cache found for ${r} but high-res missing. Requesting processing.`),a.low&&t&&t({id:r,quality:"low",processedImage:a.low});if(s){if(console.log(`ImageProcessor: Sending image ${r} to worker. Reason: ${l}`),t){const e=this.callbacks.get(r)||[];e.includes(t)||this.callbacks.set(r,[...e,t])}this.worker.postMessage({action:"processImage",id:r,src:o,width:n,height:i})}}async processBatchRequest(e,t){const r=[];for(const o of e){const{id:e,src:n,width:i,height:a}=o,s=await this.getCachedImageData(e);let l=!0;if(null==s?void 0:s.high){!Ne(s.width,s.height,i,a,.1)&&(l=!1,t&&(s.low&&t({id:e,quality:"low",processedImage:s.low}),t({id:e,quality:"high",processedImage:s.high})))}else(null==s?void 0:s.low)&&t&&t({id:e,quality:"low",processedImage:s.low});if(l&&(r.push(o),t)){const r=this.callbacks.get(e)||[];r.includes(t)||this.callbacks.set(e,[...r,t])}}r.length>0?(console.log(`ImageProcessor: Sending batch of ${r.length} images to worker (out of ${e.length}).`),this.worker.postMessage({action:"processBatch",images:r})):console.log(`ImageProcessor: All ${e.length} batch images were already fully cached with matching dimensions.`)}handleWorkerMessage(e){if("imageProcessed"===e.data.action&&e.data.id&&e.data.processedImage&&e.data.quality&&void 0!==e.data.width&&void 0!==e.data.height){const{id:t,quality:r,processedImage:o,width:n,height:i}=e.data;console.log(`ImageProcessor received processed image: ${t}, quality: ${r}, size: ${n}x${i}`),this.cacheImageData(t,r,o,n,i);const a=this.callbacks.get(t);a&&(a.forEach((e=>e({id:t,quality:r,processedImage:o}))),"high"===r&&this.callbacks.delete(t))}else console.warn("ImageProcessor received incomplete or unexpected message from worker:",e.data);this.isProcessing=!1,this.processNextRequest()}requestImageProcessing(e,t){this.requestQueue.push({type:"image",payload:e,callback:t}),this.isProcessing||this.processNextRequest()}requestBatchProcessing(e,t){this.requestQueue.push({type:"batch",payload:e,callback:t}),this.isProcessing||this.processNextRequest()}cancel(){console.log("ImageProcessor: Clearing request queue and sending cancel to worker."),this.requestQueue=[],this.callbacks.clear(),this.isWorkerCancelled=!0,this.worker.postMessage({action:"cancel"}),this.isProcessing=!1}terminate(){console.log("ImageProcessor: Terminating worker and closing DB."),this.cancel(),this.worker.terminate(),this.db&&(this.db.close(),this.db=null)}}const Pe=class e{constructor(){t(this,"imageProcessor",null),t(this,"isInitialized",!1)}static getInstance(){return e.instance||(e.instance=new e),e.instance}getImageProcessor(){return this.imageProcessor||(console.log("WorkerPool: Initializing Image Processor..."),this.imageProcessor=new Me,this.isInitialized=!0),this.imageProcessor}cancelPendingTasks(){this.imageProcessor&&this.isInitialized?(console.log("WorkerPool: Cancelling pending image processing tasks..."),this.imageProcessor.cancel()):console.log("WorkerPool: No active image processor to cancel tasks for.")}cleanup(){this.imageProcessor&&this.isInitialized?(console.log("WorkerPool: Cleaning up Image Processor..."),this.imageProcessor.terminate(),this.imageProcessor=null,this.isInitialized=!1):console.log("WorkerPool: No active image processor to clean up.")}};t(Pe,"instance");let Se=Pe;const Re="_particleBackground_1rkmm_1",$e=e=>{let t=0,r=0,o=0;return 4===e.length?(t=parseInt(e[1]+e[1],16),r=parseInt(e[2]+e[2],16),o=parseInt(e[3]+e[3],16)):7===e.length&&(t=parseInt(e[1]+e[2],16),r=parseInt(e[3]+e[4],16),o=parseInt(e[5]+e[6],16)),[t/255,r/255,o/255]},Ee=(e,t,r)=>e.map(((e,o)=>e+(t[o]-e)*r)),Te=(e,t,r)=>e+(t-e)*r,Fe=i.memo((()=>{const e=g(null),t=g(null),o=g(null),n=g(null),i=g({}),a=g({}),s=g(),{dominantColors:c,hoverState:h}=u(Y),m=g($e(c[0]||"#041024")),p=g($e(c[1]||c[0]||"#041024")),f=g(c.length>1?1:0),v=g(h.position?[h.position.x,h.position.y]:null),w=g(h.isHovering?1:0),y=l(((e,t,r)=>{const o=e.createShader(t);return o?(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(console.error(`Shader compile error (${t===e.VERTEX_SHADER?"Vertex":"Fragment"}):`,e.getShaderInfoLog(o)),e.deleteShader(o),null)):null}),[]),b=l(((e,t,r)=>{const o=e.createProgram();return o?(e.attachShader(o,t),e.attachShader(o,r),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)?o:(console.error("Program link error:",e.getProgramInfoLog(o)),e.deleteProgram(o),null)):null}),[]),_=l((e=>{const r=t.current,l=o.current;if(!r||!l)return void(s.current=requestAnimationFrame(_));const d=e/1e3,g=.08,u=$e(c[0]||"#041024"),y=$e(c[1]||c[0]||"#041024"),b=c.length>1?1:0;m.current=Ee(m.current,u,g),p.current=Ee(p.current,y,g),f.current=Te(f.current,b,g);const x=h.isHovering?1:0;if(w.current=Te(w.current,x,.16),h.isHovering&&h.position){const e=[h.position.x,h.position.y];v.current?v.current=Ee(v.current,e,.16):v.current=e}r.viewport(0,0,r.canvas.width,r.canvas.height),r.useProgram(l),r.bindBuffer(r.ARRAY_BUFFER,n.current);const I=i.current.position;-1!==I&&(r.vertexAttribPointer(I,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(I)),r.uniform2f(a.current.resolution,r.canvas.width,r.canvas.height),r.uniform1f(a.current.time,d),r.uniform3fv(a.current.colorTarget1,m.current),r.uniform3fv(a.current.colorTarget2,p.current),r.uniform1f(a.current.colorMixFactor,f.current),r.uniform1f(a.current.isHovering,w.current>.01?1:0),v.current&&r.uniform2fv(a.current.hoverPos,v.current),r.drawArrays(r.TRIANGLES,0,6),s.current=requestAnimationFrame(_)}),[c,h]);return d((()=>{const r=e.current;if(!r)return;const l=r.getContext("webgl",{alpha:!1,antialias:!0});if(!l)return void console.error("WebGL not supported or context creation failed.");t.current=l;const c=y(l,l.VERTEX_SHADER,"\n  precision mediump float;\n  attribute vec2 a_position; // Vertex position (-1 to 1)\n  varying vec2 v_uv;         // Pass UV coordinates (0 to 1) to fragment shader\n\n  void main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_uv = (a_position + 1.0) * 0.5; // Convert clip space to UV space\n    v_uv.y = 1.0 - v_uv.y; // Flip Y for texture/canvas coordinate system\n  }\n"),d=y(l,l.FRAGMENT_SHADER,"\n  precision mediump float;\n  varying vec2 v_uv; // UV coordinates from vertex shader\n\n  uniform vec2 u_resolution;    // Canvas resolution\n  uniform float u_time;        // Time for animations\n  uniform vec3 u_colorTarget1;  // Base color 1\n  uniform vec3 u_colorTarget2;  // Base color 2\n  uniform float u_colorMixFactor; // Mix factor for base colors\n\n  // Hover state uniforms\n  uniform bool u_isHovering;\n  uniform vec2 u_hoverPos;      // Normalized hover position (0-1)\n  uniform vec3 u_hoverColor;    // Optional: Color associated with hover\n\n  // --- Noise Functions ---\n  // Simple pseudo-random number generator\n  float random (vec2 st) {\n      // Adjusted seed based on example, can be tweaked\n      return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);\n  }\n\n  // Basic Value Noise function\n  float noise (vec2 st) {\n      vec2 i = floor(st); // Integer part\n      vec2 f = fract(st); // Fractional part\n\n      // Get random values for the 4 corners surrounding the point\n      float a = random(i);\n      float b = random(i + vec2(1.0, 0.0));\n      float c = random(i + vec2(0.0, 1.0));\n      float d = random(i + vec2(1.0, 1.0));\n\n      // Smoothly interpolate between the corner values (smoothstep)\n      vec2 u = f * f * (3.0 - 2.0 * f);\n      // Interpolate horizontally, then vertically\n      return mix(mix(a, b, u.x), mix(c, d, u.x), u.y);\n  }\n\n  // Fractional Brownian Motion (fBm) - layering noise\n  #define OCTAVES 4 // Number of noise layers (adjust for detail/performance)\n  float fbm (vec2 st) {\n      float value = 0.0;\n      float amplitude = 0.5;\n      float frequency = 0.0;\n      // Loop through octaves, adding noise at different frequencies/amplitudes\n      for (int i = 0; i < OCTAVES; i++) {\n          value += amplitude * noise(st);\n          st *= 2.0; // Double frequency for next octave\n          amplitude *= 0.5; // Halve amplitude for next octave\n      }\n      return value;\n  }\n  // --- End Noise Functions ---\n\n  // Function to calculate distance from hover point (same as before)\n  float getHoverDist(vec2 pos) {\n    float aspectRatio = u_resolution.x / u_resolution.y;\n    vec2 diff = pos - u_hoverPos;\n    diff.x *= aspectRatio;\n    return distance(vec2(0.0), diff);\n  }\n\n  void main() {\n    // --- Calculate Base Aura Color using Noise ---\n    // Scale UV and add time for animation. Adjust scale (e.g., * 3.0) for noise detail.\n    vec2 noisyCoord = v_uv * 2.5 + vec2(u_time * 0.02, u_time * 0.03); // Slow movement\n    float noisePattern = fbm(noisyCoord);\n\n    // Base color blend - mix between target colors\n    vec3 baseColor = mix(u_colorTarget1, u_colorTarget2, u_colorMixFactor);\n\n    // Modulate the base color blend using the noise pattern\n    // Mix based on noise value AND vertical position for variety\n    vec3 auraColor = mix(baseColor, mix(u_colorTarget1, u_colorTarget2, v_uv.y * 0.8 + 0.1), noisePattern * 0.6);\n    // Add subtle contrast/brightness variation based on noise\n    auraColor *= (0.9 + noisePattern * 0.2);\n\n    // --- Hover Effect (Applied on top of aura) ---\n    vec3 finalColor = auraColor;\n    if (u_isHovering) {\n      float dist = getHoverDist(v_uv);\n      // Ripple/glow effect - use smoothstep for soft edges\n      float hoverIntensity = smoothstep(0.20, 0.0, dist); // Increased radius slightly\n\n      // Make the glow slightly colored (e.g., whitish or based on u_hoverColor if available)\n      vec3 glowColor = vec3(0.8, 0.8, 0.9); // Whitish glow\n      // Optionally use u_hoverColor: mix(glowColor, u_hoverColor, 0.5)\n\n      // Additive blend for glow, stronger near center\n      finalColor += glowColor * hoverIntensity * 0.6; // Adjust intensity multiplier\n\n      // Optional: Slight displacement/warp effect (more complex)\n      // vec2 displacement = normalize(v_uv - u_hoverPos) * hoverIntensity * 0.01;\n      // Recalculate noise/color at v_uv - displacement ? (performance cost)\n    }\n\n    // Ensure color values stay within valid range\n    gl_FragColor = vec4(clamp(finalColor, 0.0, 1.0), 1.0);\n  }\n");if(!c||!d)return;const h=b(l,c,d);if(!h)return;o.current=h,l.detachShader(h,c),l.detachShader(h,d),l.deleteShader(c),l.deleteShader(d);const g=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);n.current=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,n.current),l.bufferData(l.ARRAY_BUFFER,g,l.STATIC_DRAW),i.current.position=l.getAttribLocation(h,"a_position"),a.current.resolution=l.getUniformLocation(h,"u_resolution"),a.current.time=l.getUniformLocation(h,"u_time"),a.current.colorTarget1=l.getUniformLocation(h,"u_colorTarget1"),a.current.colorTarget2=l.getUniformLocation(h,"u_colorTarget2"),a.current.colorMixFactor=l.getUniformLocation(h,"u_colorMixFactor"),a.current.isHovering=l.getUniformLocation(h,"u_isHovering"),a.current.hoverPos=l.getUniformLocation(h,"u_hoverPos"),a.current.hoverColor=l.getUniformLocation(h,"u_hoverColor");const u=new ResizeObserver((e=>{if(!e||0===e.length)return;const{width:r,height:o}=e[0].contentRect;t.current&&(t.current.canvas.width=r,t.current.canvas.height=o)}));return u.observe(r),s.current=requestAnimationFrame(_),()=>{s.current&&cancelAnimationFrame(s.current),u.disconnect();const e=t.current;e&&(n.current&&e.deleteBuffer(n.current),o.current&&e.deleteProgram(o.current)),t.current=null,o.current=null,n.current=null}}),[y,b,_]),r("canvas",{ref:e,className:Re,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",pointerEvents:"none",zIndex:-1}})})),Le=({images:e,zoom:t})=>e.length?r("div",{className:"banner-view space-y-4",children:e.map(((e,n)=>r(f.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*n},className:"banner-item relative",children:o("div",{className:"banner-image-container w-full h-[300px] rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300",style:{height:300*t+"px"},children:[r("img",{src:e.src,alt:e.alt,className:"w-full h-full object-cover"}),o("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4",children:[r("h3",{className:"text-white text-lg font-semibold",children:e.title}),o("p",{className:"text-white/80 text-sm",children:[e.width," × ",e.height]})]})]})},e.id)))}):r("div",{className:"text-center text-gray-500 mt-8",children:"No images to display"}),Ae=e=>{const{onClick:t}=e;return r("button",{onClick:t,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors duration-300",children:r(L,{})})},He=e=>{const{onClick:t}=e;return r("button",{onClick:t,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors duration-300",children:r(A,{})})},ze=({images:e,zoom:t})=>{if(!e.length)return r("div",{className:"text-center text-gray-500 mt-8",children:"No images to display"});return r("div",{className:"carousel-view",children:r(F,{...{dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:r(Ae,{}),prevArrow:r(He,{}),adaptiveHeight:!0,customPaging:e=>r("div",{className:"w-3 h-3 mx-1 rounded-full bg-white/50 hover:bg-white/70 transition-colors duration-300"})},children:e.map(((e,n)=>r(f.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"outline-none",children:o("div",{className:"relative aspect-video",children:[r("img",{src:e.src,alt:e.alt,className:"w-full h-full object-contain",style:{maxHeight:600*t+"px"}}),o("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4",children:[r("h3",{className:"text-white text-lg font-semibold",children:e.title}),o("p",{className:"text-white/80 text-sm",children:[e.width," × ",e.height]})]})]})},e.id)))})})},qe=({images:e,zoom:t})=>e.length?r(z,{breakpointCols:{default:4,1536:4,1280:3,1024:3,768:2,640:1},className:"flex -ml-4 w-auto",columnClassName:"pl-4 bg-clip-padding",children:e.map(((e,n)=>r(f.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1*n},className:"mb-4",children:o("div",{className:"relative group rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-shadow duration-300",children:[r("img",{src:e.src,alt:e.alt,className:"w-full h-auto",style:{maxHeight:400*t+"px",objectFit:"cover"}}),o("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300",children:[r("h3",{className:"text-white text-lg font-semibold",children:e.title}),o("p",{className:"text-white/80 text-sm",children:[e.width," × ",e.height]})]})]})},e.id)))}):r("div",{className:"text-center text-gray-500 mt-8",children:"No images to display"});function We(e,t){let r=null;const o=(...o)=>{null!==r&&clearTimeout(r),r=setTimeout((()=>e(...o)),t)};return o.cancel=()=>{null!==r&&(clearTimeout(r),r=null)},o}const Be=i.memo((({folderPath:e,isGrouped:t,zoom:n,viewMode:i,scrollContainerRef:a})=>{const{data:h,isLoading:p,isError:v,error:k,isPlaceholderData:N}=ge(e);!function(){const[e,t]=s({width:window.innerWidth,height:window.innerHeight}),r=l((()=>{const r=window.innerWidth,o=window.innerHeight;r===e.width&&o===e.height||requestAnimationFrame((()=>{t({width:r,height:o})}))}),[e.width,e.height]);d((()=>{let e=null;function t(){e&&clearTimeout(e),e=setTimeout(r,150)}return r(),window.addEventListener("resize",t),()=>{e&&clearTimeout(e),window.removeEventListener("resize",t)}}),[r])}();const M=g(null),[$,E]=s(0),[T,F]=s(4),[L,A]=s(-1),[H,z]=s([]);s([]);const{scrollY:q}=w();y(q,[0,300],[0,200]),y(q,[0,300],[0,-200]),c((()=>re.getInstance()),[]);const{setDominantColors:W,setHoverState:B}=u(Y),j=g(null),O=g(null),V=g(null),[Q,Z]=s(null),K=g(null),X=g([]),J=g(!1),ee=g(0),te=c((()=>Se.getInstance()),[]),[oe,ne]=s(3),[ie,ae]=s(new Set),[ce,de]=s(t),he=l(R((e=>{de(e),console.log("[ImageFeed] Applying debounced isGrouped:",e)}),300),[]);d((()=>(he(t),()=>{he.cancel()})),[t,he]);const me=l((e=>{ae((t=>{if(t.has(e))return t;console.log(`ImageFeed: Registering error for image ${e}`);const r=new Set(t);return r.add(e),r}))}),[]),we=l(We(((e,t)=>{e&&!J.current&&fe(e,t)}),500),[]);d((()=>{let t=!0;(async()=>{const r=await async function(e){try{const t=(await pe()).transaction(ue,"readonly"),r=t.objectStore(ue),o=await r.get(e);return await t.done,o??null}catch(k){return console.error("Failed to load scroll state for path:",e,k),null}}(e);t&&(r?(Z(r),J.current=!0):(Z(null),a.current&&(a.current.scrollTop=0),J.current=!1))})();const r=e;return K.current=r,()=>{var e;t=!1;const r=a.current,o=K.current;r&&o&&X.current.length>0&&fe(o,r.scrollTop),null==(e=we.cancel)||e.call(we),console.log("ImageFeed: Unmounting, cancelling pending tasks."),te.cancelPendingTasks()}}),[e,a,we,te]);const ye=c((()=>{if(!h||0===h.length)return 1;const e=h.filter((e=>e&&e.width>0&&e.height>0));if(0===e.length)return 1;return e.reduce(((e,t)=>e+t.width/t.height),0)/e.length}),[h]),_e=c((()=>{const e=be(n);let t=200;if($>0&&T>0&&ye>0){const r=Math.max(0,T-1)*e,o=Math.max(0,$-r);if(o>0){const e=o/T;t=Math.max(50,Math.round(e/ye))}}return{gapSize:e,estimatedRowHeightFallback:t}}),[$,T,n,ye]);d((()=>{A(-1),z([]),O.current=null,W([]),ae(new Set),console.log(`ImageFeed: ${e?"Folder":"ViewMode/Group"} changed, cancelling pending tasks.`),te.cancelPendingTasks()}),[e,i,t,W,te]),d((()=>{console.log("ImageFeed: Zoom changed, cancelling pending tasks."),te.cancelPendingTasks()}),[n,te]),d((()=>(j.current=new S,()=>{var e,t;null==(t=null==(e=j.current)?void 0:e.destroy)||t.call(e)})),[]);const xe=l((()=>{if(!M.current)return;const e=M.current.getBoundingClientRect(),t=Math.max(ve,e.width);E((e=>{if(t!==e){const e=ke({containerWidth:t,zoom:n,viewMode:i,isGrouped:ce});return F(e.columns),t}return e}))}),[n,i,ce,he]);m((()=>{xe()}),[xe]),d((()=>{const e=new ResizeObserver(xe);return M.current&&e.observe(M.current),window.addEventListener("resize",xe),()=>{e.disconnect(),window.removeEventListener("resize",xe)}}),[xe]);const Ie=c((()=>h?h.filter((e=>!ie.has(e.id))):[]),[h,ie]),Ne=c((()=>{if(console.time("groupedImages calculation"),!Array.isArray(Ie)||0===Ie.length)return console.timeEnd("groupedImages calculation"),[];const e=Ie.filter((e=>e&&"object"==typeof e&&"width"in e&&"height"in e&&e.width>0&&e.height>0));if(!ce){const t=e.map((e=>({key:e.id,images:[e],isCarousel:!1})));return console.timeEnd("groupedImages calculation"),t}console.time("groupedImages - precompute titles");const t=new Map;e.forEach((e=>{t.set(e.id,G(e.alt))})),console.timeEnd("groupedImages - precompute titles"),console.time("groupedImages - grouping loop");const r={};e.forEach((e=>{const o=t.get(e.id)||"Untitled";r[o]||(r[o]=[]),r[o].push(e)})),console.timeEnd("groupedImages - grouping loop"),console.time("groupedImages - convert to array");const o=Object.entries(r).map((([e,t])=>({key:e,images:t,isCarousel:t.length>1})));return console.timeEnd("groupedImages - convert to array"),console.timeEnd("groupedImages calculation"),o}),[Ie,ce]),Me=c((()=>{if(!$||0===Ne.length||i!==U.GRID)return[];const e=Ne.map((e=>e.images[0])).filter((e=>e&&e.width>0&&e.height>0));return 0===e.length?[]:Ce(e,$,n,_e.estimatedRowHeightFallback)}),[Ne,n,$,i,_e.estimatedRowHeightFallback]);d((()=>{i===U.GRID&&Me&&Me.length>0?X.current=Me.map((e=>e.height)):X.current=[]}),[Me,i,e]),l((e=>{console.warn("Image overflow detected:",e.id)}),[]);const Pe=l((e=>{const t=Ne.findIndex((t=>t.images.some((t=>t.id===e.id))));if(-1!==t){const r=Ne[t],o=r.images.findIndex((t=>t.id===e.id));-1!==o&&(z(r.images),A(o))}}),[Ne,z,A]),Re=g(0),$e=g(performance.now()),Ee=l((()=>{const t=a.current;if(!t)return;const r=performance.now(),o=t.scrollTop,n=r-$e.current,i=o-Re.current;if(n>10){const t=Math.abs(i)/n;ee.current=.2*t+.8*ee.current;const a=3+Math.min(10*ee.current,12);ne(Math.round(a)),Re.current=o,$e.current=r,we(e,o)}}),[a,e,we]);d((()=>{const e=a.current;if(e){const t=function(e,t){let r;return function(...o){const n=this;r||(r=!0,setTimeout((()=>r=!1),t),e.apply(n,o))}}(Ee,100);return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)}}),[a,Ee]);const Te=P({count:Me.length,getScrollElement:()=>a.current,estimateSize:l((e=>{var t;return((null==(t=Me[e])?void 0:t.height)??_e.estimatedRowHeightFallback)+_e.gapSize}),[Me,_e.estimatedRowHeightFallback,_e.gapSize,i]),overscan:oe});m((()=>{var e;null==(e=Te.measure)||e.call(Te)}),[n,$,Me.length,_e.estimatedRowHeightFallback,_e.gapSize,i,ce,e]);const Ae=Te.getVirtualItems();m((()=>{const e=a.current;J.current&&Q&&X.current.length>0&&(e?(console.log(`Restoring scroll to: ${Q.scrollTop}`),requestAnimationFrame((()=>{e.scrollTop=Q.scrollTop,J.current=!1}))):J.current=!1)}),[Q,a,Ae,e]);const He=l((e=>{V.current&&(clearTimeout(V.current),V.current=null),e.isHovering?V.current=setTimeout((()=>{B({isHovering:!0,position:e.position,color:e.color})}),150):B({isHovering:!1,position:null,color:null})}),[B]);d((()=>()=>{V.current&&clearTimeout(V.current)}),[]);const Be=l((e=>{let t=e.replace(/\\/g,"/");return t.startsWith("/api/image/")||t.startsWith("/")?t:`/api/image/${t}`}),[]),je=c((()=>[_,x,I,C]),[]),De=c((()=>H.length?H.map((e=>({src:Be(e.src),alt:e.alt,title:e.title,width:e.width,height:e.height}))):[]),[H,Be]);l(We((async e=>{if(e&&j.current)try{const t=await j.current.getColorAsync(e);t.hex&&W([t.hex])}catch(t){console.error("Error getting average color:",t)}}),300),[W,Be]),d((()=>{if(Ie&&Ie.length>0&&null===O.current){const e=Ie[0];if(null==e?void 0:e.src){const t=Be(e.src);(async()=>{if(t&&j.current)try{const e=await j.current.getColorAsync(t);e.hex&&(W([e.hex]),O.current=0)}catch(e){console.error("Error getting initial average color:",e)}})()}}}),[Ie,Be,W]);const Ue=l((()=>{const{gapSize:e}=_e,t=$>0&&T>0?$/T-e:200,o=ye>0?t/ye:150,n=5*T;return t<=0||o<=0?null:r(f.div,{className:D.gridContainer,style:{gap:`${e}px`},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:Array.from({length:n}).map(((e,n)=>r(le,{containerWidth:Math.round(t),containerHeight:Math.round(o)},`skeleton-${n}`)))},"skeleton-grid")}),[T,_e,$,ye,D.gridContainer]);if(v)return o("div",{ref:M,className:`${D.container} ${D.error}`,children:["Error loading images: ",(null==k?void 0:k.message)||"Unknown error"]});if(p&&!N)return r("div",{ref:M,className:D.container,children:r("div",{className:`${D.feed} ${D.loading}`,children:Ue()})});return!(p||Ie&&0!==Ie.length)?r("div",{ref:M,className:D.container,children:r(f.div,{initial:{opacity:0},animate:{opacity:1},className:D.noImages,children:"No images found for this folder."})}):o("div",{ref:M,className:D.container,style:{position:"relative"},children:[r(Fe,{}),r("div",{className:D.feed,children:(()=>{const{gapSize:e}=_e;if(!$)return null;const t=Ie??[];f.div;const o=p&&!N;if(i!==U.GRID){let e;switch(i){case U.MASONRY:e=qe;break;case U.BANNER:e=Le;break;case U.CAROUSEL:e=ze;break;default:return null}return r(e,{images:t,zoom:n})}return o?Ue():r("div",{style:{height:`${Te.getTotalSize()}px`,width:"100%",position:"relative"},children:r("div",{style:{width:"100%",position:"relative"},children:Ae.map((t=>{const o=Me[t.index];return o?r("div",{"data-index":t.index,ref:Te.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",height:`${t.size}px`,transform:`translateY(${t.start}px)`},children:r(se,{images:o.images,imageWidths:o.imageWidths??[],onImageClick:Pe,columns:T,zoom:n,isLastRow:t.index===Me.length-1,rowHeight:o.height,groupedImages:Ne,workerPool:te,gap:e,containerWidth:$,onImageHover:He,onImageLoadError:me})},t.key):null}))})})})()}),r(b,{open:-1!==L,close:()=>A(-1),index:L,slides:De,plugins:je})]})})),je=({selectedFolder:e,isGrouped:t,zoom:o,viewMode:n,scrollContainerRef:i})=>r("div",{className:`${B} flex flex-col h-full bg-transparent`,children:r("div",{className:`${j} flex-1`,children:r(Be,{folderPath:e,isGrouped:t,zoom:o,viewMode:n,scrollContainerRef:i})})}),De=({selectedFolder:e,searchQuery:t,zoom:o,isGrouped:i,viewMode:a,scrollContainerRef:s})=>r(n,{children:r(je,{selectedFolder:e,zoom:o,isGrouped:i,viewMode:a,scrollContainerRef:s})}),Ue="_navbar_1wwjh_2",Ge="_leftSection_1wwjh_10",Oe="_rightSection_1wwjh_15",Ve="_navbarBackground_1wwjh_19",Qe="_viewToggleButton_1wwjh_46",Ze="_viewModeButtons_1wwjh_57",Ye="_viewModeButton_1wwjh_57",Ke="_active_1wwjh_75";const Xe=()=>{const{data:e,isLoading:t,isError:n}=$({queryKey:["currentDirectory"],queryFn:he,staleTime:18e5,refetchOnWindowFocus:!1});let i="...",a="bg-gray-600 text-gray-400 cursor-not-allowed",s="text-gray-500";return n?(i="Error",a="bg-red-800 text-red-200 cursor-not-allowed",s="text-red-400"):!t&&e&&(i=e,a="bg-gray-700 text-peach hover:bg-gray-600",s="text-yellow-500"),o(f.button,{className:`flex items-center px-3 py-1 rounded-md text-sm transition-all duration-300 ease-in-out ${a}`,whileHover:t||n?{}:{scale:1.05},whileTap:t||n?{}:{scale:.95},disabled:t||n,children:[r(q,{size:16,className:`mr-2 ${s}`}),r(f.div,{className:"truncate max-w-xs",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:r("span",{children:i})})]})},Je="_searchBarContainer_3g2eh_1",et="_searchBackground_3g2eh_19",tt="_searchInput_3g2eh_41",rt=({onSearch:e})=>{const[t,n]=s("");v();return o(f.form,{onSubmit:r=>{r.preventDefault(),e(t)},className:Je,initial:{width:"200px"},animate:{width:t?"300px":"200px"},transition:{type:"spring",stiffness:300,damping:30},children:[r(f.div,{className:et,animate:{background:t?"linear-gradient(90deg, #4a00e0 0%, #8e2de2 100%)":"rgba(255, 255, 255, 0.1)"}}),r(f.input,{type:"text",value:t,onChange:e=>n(e.target.value),className:tt,placeholder:"Search the future...",whileFocus:{scale:1.05},transition:{type:"spring",stiffness:400,damping:30}})]})},ot=({zoom:e,onZoomChange:t})=>{const[n,i]=s(!1),a=v(),l=(e-.5)/1.5*100+"%",c=n?1:.6,h=n?1.1:1;return d((()=>{a.start({scale:n?1.05:1,transition:{type:"spring",stiffness:300,damping:20}})}),[n,a]),o(f.div,{className:"relative flex items-center bg-gray-800/80 backdrop-blur-md rounded-full p-3 overflow-hidden",style:{boxShadow:"0 4px 12px rgba(0,0,0,0.1)",width:"200px"},animate:a,children:[o(f.div,{className:"relative",whileHover:{scale:1.2},whileTap:{scale:.95},onClick:()=>t(Math.max(.5,e-.1)),children:[r(f.svg,{className:"text-gray-200 mr-3 cursor-pointer",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",whileHover:{rotate:-90},transition:{duration:.3},children:r("path",{d:"M21 21L16.65 16.65M11 8V14M8 11H14M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),r(f.div,{style:{position:"absolute",top:"50%",left:"50%",width:"30px",height:"30px",background:"radial-gradient(circle, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0) 70%)",transform:"translate(-50%, -50%)",pointerEvents:"none"},animate:{opacity:c,scale:h},transition:{type:"spring",stiffness:300,damping:20}})]}),o("div",{className:"relative flex-1 h-2 bg-gray-700 rounded-full overflow-hidden",children:[r(f.div,{className:"absolute top-0 left-0 h-full bg-blue-500 rounded-full",style:{boxShadow:"0 0 10px rgba(59,130,246,0.5)"},animate:{width:l},transition:{type:"spring",stiffness:300,damping:10,precision:.01}}),r("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:e,onChange:e=>t(parseFloat(e.target.value)),onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onTouchStart:()=>i(!0),onTouchEnd:()=>i(!1),className:"absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer"})]}),o(f.div,{className:"relative",whileHover:{scale:1.2},whileTap:{scale:.95},onClick:()=>t(Math.min(2,e+.1)),children:[r(f.svg,{className:"text-gray-200 ml-3 cursor-pointer",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",whileHover:{rotate:90},transition:{duration:.3},children:r("path",{d:"M21 21L16.65 16.65M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),r(f.div,{style:{position:"absolute",top:"50%",left:"50%",width:"30px",height:"30px",background:"radial-gradient(circle, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0) 70%)",transform:"translate(-50%, -50%)",pointerEvents:"none"},animate:{opacity:c,scale:h},transition:{type:"spring",stiffness:300,damping:20}})]})]})},nt=({onSearch:e,zoom:t,onZoomChange:n,isGrouped:i,onGroupToggle:a,viewMode:s,onViewModeChange:l})=>{const c=g(null);return d((()=>{const e=c.current;if(e){(()=>{const t=e.querySelector("path");if(t){const e=t.getTotalLength();t.style.strokeDasharray=`${e} ${e}`,t.style.strokeDashoffset=`${e}`,t.getBoundingClientRect(),t.style.transition="stroke-dashoffset 2s ease-in-out",t.style.strokeDashoffset="0"}})()}}),[]),o(f.div,{className:Ue,initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:.5},children:[r("svg",{ref:c,className:Ve,children:r("path",{d:"M0,0 Q50,20 100,10 T200,30 T300,5 T400,25 V100 Q350,80 300,90 T200,70 T100,95 T0,75 Z"})}),o("div",{className:Ge,children:[r(Xe,{})," ",r(rt,{onSearch:e})]}),o("div",{className:Oe,children:[r("div",{className:Ze,children:Object.values(U).map((e=>r(f.button,{onClick:()=>l(e),className:`${Ye} ${s===e?Ke:""}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:e.charAt(0).toUpperCase()+e.slice(1)},e)))}),r(f.button,{onClick:a,className:Qe,whileHover:{scale:1.05},whileTap:{scale:.95},children:i?"Ungroup":"Group"}),r(ot,{zoom:t,onZoomChange:n})]})]})};const it={sidebar:"_sidebar_1d71g_2",logo:"_logo_1d71g_7",folderList:"_folderList_1d71g_12",folderItem:"_folderItem_1d71g_17",folderButton:"_folderButton_1d71g_22",selectedFolder:"_selectedFolder_1d71g_30",uploadButton:"_uploadButton_1d71g_35"},at="loraFinderHomeDirectory",st=()=>{try{return localStorage.getItem(at)}catch(e){return console.error("Error reading home directory from localStorage:",e),null}},lt=({selectedFolder:e,onFolderChange:t})=>{const{data:n,isLoading:i,isError:a,error:l}=$({queryKey:["folders"],queryFn:de}),[c,h]=s(null);d((()=>{h(st())}),[]);const g=(e,t)=>{t.stopPropagation(),(e=>{try{localStorage.setItem(at,e)}catch(l){console.error("Error setting home directory in localStorage:",l)}})(e),h(e),console.log("Set home directory:",e)};return i?r(f.div,{initial:{x:-300},animate:{x:0},transition:{type:"spring",stiffness:120},className:`${it.sidebar} ${it.loading}`,children:"Loading folders..."}):a?o(f.div,{initial:{x:-300},animate:{x:0},transition:{type:"spring",stiffness:120},className:`${it.sidebar} ${it.error}`,children:["Error: ",(null==l?void 0:l.message)||"Failed to load folders"]}):r(f.div,{initial:{x:-300},animate:{x:0},transition:{type:"spring",stiffness:120},className:it.sidebar,children:o("div",{className:`${it.sidebar} flex flex-col h-full`,children:[r("div",{className:it.logo,children:"Lora Finder"}),r("ul",{className:`${it.folderList} flex-grow overflow-y-auto`,children:(n??[]).map((n=>r("li",{className:`${it.folderItem} group`,children:o("button",{onClick:()=>{t(n.name)},className:`${it.folderButton} ${e===n.name?it.selectedFolder:""}`,children:[r("span",{className:it.folderName,children:n.name}),r("button",{onClick:e=>g(n.name,e),className:`${it.setHomeButton} ${n.name===c?it.isHome:"opacity-0 group-hover:opacity-100"}`,title:`Set ${n.name} as home directory`,children:r(H,{})})]})},n.name)))}),r("div",{className:"p-8 mt-auto",children:r("button",{className:`${it.uploadButton} w-full`,children:"Upload"})})]})})},ct="--scroll-y",dt="--mouse-x",ht="--mouse-y",gt={[ct]:"0px",[dt]:"0px",[ht]:"0px"};k.registerPlugin(W);const ut=({children:e,selectedFolder:t,onFolderChange:n,onSearch:i,zoom:a,onZoomChange:l,isGrouped:c,onGroupToggle:h,viewMode:g,onViewModeChange:u,mainRef:m})=>{d((()=>{function e(e){const t=e.clientX,r=e.clientY;document.documentElement.style.setProperty(dt,`${t}px`),document.documentElement.style.setProperty(ht,`${r}px`)}function t(){const e=window.scrollY;document.documentElement.style.setProperty(ct,`${e}px`)}return Object.entries(gt).forEach((([e,t])=>{document.documentElement.style.setProperty(e,t)})),window.addEventListener("scroll",t),document.addEventListener("mousemove",e),document.addEventListener("click",e),()=>{window.removeEventListener("scroll",t),document.removeEventListener("mousemove",e),document.removeEventListener("click",e)}}),[]);const[p,f]=s("");return r("div",{className:"flex flex-col h-screen relative bg-transparent",children:o(K,{children:[r("div",{className:"gradient-overlay"}),r(Fe,{}),r(nt,{onSearch:e=>{f(e),i(e)},zoom:a,onZoomChange:l,isGrouped:c,onGroupToggle:h,viewMode:g,onViewModeChange:u}),o("div",{className:"flex flex-1 overflow-hidden",children:[r(lt,{selectedFolder:t,onFolderChange:n}),r("main",{ref:m,className:"flex-1 overflow-auto p-4 relative bg-transparent",children:r("div",{className:"relative z-10",children:r(De,{selectedFolder:t,searchQuery:p,zoom:a,isGrouped:c,viewMode:g,scrollContainerRef:m})})})]})]})})},mt=()=>{const[e,t]=s((()=>st()||"")),[o,n]=s(1),[i,a]=s(""),[l,c]=s(!0),[d,h]=s(U.GRID),u=g(null);return r(ut,{selectedFolder:e,onFolderChange:e=>{t(e)},onSearch:e=>{a(e)},zoom:o,onZoomChange:e=>{n(e)},isGrouped:l,onGroupToggle:()=>{c((e=>!e))},viewMode:d,onViewModeChange:e=>{h(e)},mainRef:u,children:r(De,{zoom:o,searchQuery:i,selectedFolder:e,isGrouped:l,viewMode:d,scrollContainerRef:u})})};function pt(){return r("div",{className:"App",children:r(mt,{})})}function ft(){return{html:p.renderToString(r(i.StrictMode,{children:r(pt,{})}))}}export{ft as render};
//# sourceMappingURL=entry-server.js.map
