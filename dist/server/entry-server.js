var e=Object.defineProperty,r=(r,t,o)=>((r,t,o)=>t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[t]=o)(r,"symbol"!=typeof t?t+"":t,o);import{jsx as t,jsxs as o,Fragment as i}from"react/jsx-runtime";import n,{createContext as a,useState as s,useCallback as l,useMemo as c,useContext as u,useRef as h,useEffect as d,memo as g,useLayoutEffect as m}from"react";import p from"react-dom/server";import{useVirtualizer as f}from"@tanstack/react-virtual";import{motion as w,useAnimation as v}from"framer-motion";import y from"lodash/debounce.js";import b from"yet-another-react-lightbox";import k from"yet-another-react-lightbox/plugins/captions";import _ from"yet-another-react-lightbox/plugins/counter";import R from"yet-another-react-lightbox/plugins/thumbnails";import x from"yet-another-react-lightbox/plugins/zoom";import{useQuery as C}from"@tanstack/react-query";import I from"axios";import E from"lodash/throttle.js";import*as P from"comlink";import{wrap as $}from"comlink";import{openDB as W}from"idb";import q from"p-queue";import{v4 as L}from"uuid";import M from"gsap";import{CustomEase as U}from"gsap/CustomEase.js";import{ScrollTrigger as N}from"gsap/ScrollTrigger.js";import T from"react-slick";import{FaChevronRight as S,FaChevronLeft as F,FaHome as A}from"react-icons/fa";import z from"react-masonry-css";import{IconFolder as H}from"@tabler/icons-react";import{ScrollToPlugin as G}from"gsap/ScrollToPlugin.js";const B="_imageViewer_feuzf_1",j="_contentContainer_feuzf_8",D="#041024",O={isHovering:!1,position:null,color:null},Q=a({dominantColors:[D],setDominantColors:()=>{},hoverState:O,setHoverState:()=>{}}),V=({children:e})=>{const[r,o]=s([D]),[i,n]=s(O),a=l((e=>{n((r=>({...r,...e})))}),[]),u=c((()=>({dominantColors:r,setDominantColors:o,hoverState:i,setHoverState:a})),[r,i,a]);return t(Q.Provider,{value:u,children:e})},Z=a(null),Y=()=>{const e=u(Z);if(!e)throw new Error("useImageProcessing must be used within an ImageProcessingProvider");return e},K=I.create({baseURL:"/api"});async function X(){try{return(await K.get("/folders")).data.map((e=>({name:e.name,path:e.path})))}catch(e){throw console.error("Error in getFolders:",e),new Error("Failed to fetch folders")}}async function J(){try{return(await K.get("/getCurrentDirectory")).data.currentDirectory}catch(e){throw console.error("Error in getCurrentDirectory:",e),new Error("Failed to get current directory")}}function ee(e){return C({queryKey:["images",e],queryFn:()=>async function(e){var r;if(!e)throw new Error("Folder parameter is required");try{const r=await K.get(`/images?folder=${encodeURIComponent(e)}`);if(!Array.isArray(r.data))throw console.error("Invalid response data:",r.data),new Error("Invalid response format from server");return r.data}catch(t){if(t.response){const e=(null==(r=t.response.data)?void 0:r.error)||t.response.statusText;throw new Error(`Server error: ${e}`)}throw t.request?new Error("No response from server"):(console.error("Error in getImages:",t),new Error(t.message||"Failed to fetch images"))}}(e),enabled:!!e,placeholderData:e=>e})}const re="processed-images";let te=null;const oe=()=>(te||(te=W("image-processor-cache",1,{upgrade(e){e.objectStoreNames.contains(re)||e.createObjectStore(re,{keyPath:"id"})}})),te);class ie{constructor(e){r(this,"worker"),r(this,"proxy"),r(this,"queue"),r(this,"onError"),r(this,"activeRequests",new Map),r(this,"publisher",null),this.onError=null==e?void 0:e.onError;const t=(null==e?void 0:e.concurrency)??Math.max(1,(navigator.hardwareConcurrency||4)-1);this.queue=new q({concurrency:t}),console.log(`ImageProcessor: Initialized queue with concurrency ${t}`),this.worker=new Worker(new URL("./imageProcessorWorker.worker.ts",import.meta.url),{type:"module"}),this.proxy=$(this.worker),this.worker.onerror=e=>{var r;console.error("Unhandled error in ImageProcessorWorker:",e),null==(r=this.onError)||r.call(this,"WORKER_FATAL",e.message||"Worker failed")},this.initializeCacheCheck()}async initializeCacheCheck(){try{await this.checkCacheForStaleBlobs()}catch(e){console.error("Failed initial cache check:",e)}}setPublisher(e){console.log("[ImageProcessor] Publisher function set."),this.publisher=e}async getCacheEntry(e){return(await oe()).get(re,e)}async setCacheEntry(e){const r=await oe();await r.put(re,e)}async deleteCacheEntry(e){const r=await oe();await r.delete(re,e)}async checkCacheForStaleBlobs(){console.log("ImageProcessor: Checking cache for stale blob URLs...");const e=await oe(),r=await e.getAll(re);let t=0;for(const i of r){let e=!1;try{if(i.lowResUrl&&i.lowResUrl.startsWith("blob:")){const r=await fetch(i.lowResUrl).catch((()=>null));r&&r.ok||(console.warn(`Stale low-res blob URL found for ${i.id}. Removing.`),e=!0)}if(i.highResUrl&&i.highResUrl.startsWith("blob:")){const r=await fetch(i.highResUrl).catch((()=>null));r&&r.ok||(console.warn(`Stale high-res blob URL found for ${i.id}. Removing.`),e=!0)}}catch(o){console.warn(`Error checking blob URL for ${i.id}. Assuming stale.`,o),e=!0}e&&(await this.deleteCacheEntry(i.id),t++)}t>0?console.log(`ImageProcessor: Removed ${t} stale cache entries.`):console.log("ImageProcessor: No stale blob URLs found in cache.")}async processImage(e){var r,t,o;const{id:i,src:n,width:a,height:s}=e;if(!(i&&n&&a&&s))return console.error("Invalid image data provided to processImage:",e),void(null==(r=this.onError)||r.call(this,i||"unknown","Invalid image data"));try{const e=await this.getCacheEntry(i),r=(null==e?void 0:e.lowResWidth)===Math.round(a/4)&&(null==e?void 0:e.lowResHeight)===Math.round(s/4),n=(null==e?void 0:e.width)===a&&(null==e?void 0:e.height)===s;if((null==e?void 0:e.lowResUrl)&&(null==e?void 0:e.highResUrl)&&r&&n)return console.log(`ImageProcessor: Cache hit for ${i} (pre-queue). Skipping queue.`),null==(t=this.publisher)||t.call(this,{id:i,quality:"low",imageUrl:e.lowResUrl,width:e.lowResWidth,height:e.lowResHeight}),void(null==(o=this.publisher)||o.call(this,{id:i,quality:"high",imageUrl:e.highResUrl,width:e.width,height:e.height}))}catch(c){console.error(`ImageProcessor: Error checking cache pre-queue for ${i}:`,c)}if(this.activeRequests.has(i))return void console.log(`ImageProcessor: Request for ${i} is already active/queued. Skipping.`);const l=new AbortController;this.activeRequests.set(i,l),this.queue.add((async()=>{var e,r,t,o,c,u,h;console.log(`ImageProcessor: Starting queued task for ${i}. Queue size: ${this.queue.size}`);let d=null;try{const h=await this.getCacheEntry(i),m=(null==h?void 0:h.lowResWidth)===Math.round(a/4)&&(null==h?void 0:h.lowResHeight)===Math.round(s/4),p=(null==h?void 0:h.width)===a&&(null==h?void 0:h.height)===s;if((null==h?void 0:h.lowResUrl)&&(null==h?void 0:h.highResUrl)&&m&&p)return console.log(`ImageProcessor: Cache hit for ${i} (in-queue). Skipping processing.`),null==(e=this.publisher)||e.call(this,{id:i,quality:"low",imageUrl:h.lowResUrl,width:h.lowResWidth,height:h.lowResHeight}),void(null==(r=this.publisher)||r.call(this,{id:i,quality:"high",imageUrl:h.highResUrl,width:h.width,height:h.height}));if(l.signal.aborted)throw new DOMException("Aborted before processing","AbortError");let f="No cache entry";!h||m&&p?(null==h?void 0:h.lowResUrl)&&m?(f=`Low-res cache hit for ${i}, processing for high-res.`,null==(t=this.publisher)||t.call(this,{id:i,quality:"low",imageUrl:h.lowResUrl,width:h.lowResWidth,height:h.lowResHeight})):h&&(f=`Inconsistent cache state for ${i}. Requesting re-processing.`,await this.deleteCacheEntry(i)):(f=`Cache found for ${i} but dimensions mismatch. Requesting re-processing.`,await this.deleteCacheEntry(i)),console.log(`ImageProcessor: Fetching image ${i} to create ImageBitmap (queued).`);try{const e=await fetch(n,{signal:l.signal});if(!e.ok)throw new Error(`Failed to fetch image: ${e.statusText}`);const r=await e.blob();if(l.signal.aborted)throw new DOMException("Aborted","AbortError");d=await createImageBitmap(r)}catch(g){throw"AbortError"!==g.name&&(console.error(`ImageProcessor: Error fetching/creating bitmap for ${i} (queued):`,g),null==(o=this.onError)||o.call(this,i,g.message||"Failed to load image data")),g}if(l.signal.aborted)throw new DOMException("Aborted before worker call","AbortError");console.log(`ImageProcessor: Sending image ${i} to worker via Comlink (queued). Reason: ${f}`);const w=await this.proxy.processImage(P.transfer({id:i,imageBitmap:d,width:a,height:s},[d]));if(d=null,l.signal.aborted)return console.log(`ImageProcessor: Processing for ${i} aborted after worker call (queued).`),w.lowResUrl&&URL.revokeObjectURL(w.lowResUrl),void(w.highResUrl&&URL.revokeObjectURL(w.highResUrl));console.log(`ImageProcessor: Received results for ${i} from worker (queued).`);const v={...await this.getCacheEntry(i)||{id:i},id:i,lowResUrl:w.lowResUrl??(null==h?void 0:h.lowResUrl),lowResWidth:w.lowResUrl?Math.round(a/4):null==h?void 0:h.lowResWidth,lowResHeight:w.lowResUrl?Math.round(s/4):null==h?void 0:h.lowResHeight,highResUrl:w.highResUrl,width:w.highResUrl?a:null==h?void 0:h.width,height:w.highResUrl?s:null==h?void 0:h.height,timestamp:Date.now()};await this.setCacheEntry(v),w.lowResUrl&&(null==(c=this.publisher)||c.call(this,{id:i,quality:"low",imageUrl:v.lowResUrl,width:v.lowResWidth,height:v.lowResHeight})),w.highResUrl&&(null==(u=this.publisher)||u.call(this,{id:i,quality:"high",imageUrl:v.highResUrl,width:v.width,height:v.height}))}catch(m){"AbortError"===m.name?console.log(`ImageProcessor: Queued task for ${i} aborted.`):(console.error(`ImageProcessor: Error during queued processing for ${i}:`,m),null==(h=this.onError)||h.call(this,i,m.message||"Queued processing failed"))}finally{if(d)try{d.close()}catch(p){console.warn(`Error closing untransferred bitmap for ${i} (queued):`,p)}this.activeRequests.delete(i),console.log(`ImageProcessor: Finished queued task for ${i}. Queue size: ${this.queue.size}`)}})).catch((e=>{var r;console.error(`ImageProcessor: Error adding task to queue for ${i}:`,e),this.activeRequests.delete(i),null==(r=this.onError)||r.call(this,i,e.message||"Failed to queue task")}))}async processBatch(e){const r=`batch-${Date.now()}-${Math.random().toString(16).slice(2)}`;if(this.activeRequests.has(r))return void console.log(`ImageProcessor: Batch request ${r} appears to be already active/queued. Skipping.`);const t=new AbortController;this.activeRequests.set(r,t),this.queue.add((async()=>{var o,i,n,a;console.log(`ImageProcessor: Starting queued batch task ${r}. Queue size: ${this.queue.size}`);const s=[],l=[],c=[],u=[];let h=null;try{console.log(`ImageProcessor: Starting batch preparation for ${e.length} images (queued). Batch ID: ${r}`);for(const r of e){const{id:e,src:i,width:n,height:a}=r;e&&i&&n&&a?c.push((async()=>{var r,o,c,h;if(t.signal.aborted)return;let d=null;try{const h=await this.getCacheEntry(e),g=(null==h?void 0:h.lowResWidth)===Math.round(n/4)&&(null==h?void 0:h.lowResHeight)===Math.round(a/4),m=(null==h?void 0:h.width)===n&&(null==h?void 0:h.height)===a;if((null==h?void 0:h.lowResUrl)&&(null==h?void 0:h.highResUrl)&&g&&m){if(t.signal.aborted)return;return null==(r=this.publisher)||r.call(this,{id:e,quality:"low",imageUrl:h.lowResUrl,width:h.lowResWidth,height:h.lowResHeight}),void(null==(o=this.publisher)||o.call(this,{id:e,quality:"high",imageUrl:h.highResUrl,width:h.width,height:h.height}))}if(h&&(!g||!m)){if(t.signal.aborted)return;console.log(`ImageProcessor: Clearing mismatched cache for batch item ${e} (queued)`),await this.deleteCacheEntry(e)}if(t.signal.aborted)return;console.log(`ImageProcessor: Fetching batch item ${e} (queued)`);const p=await fetch(i,{signal:t.signal});if(!p.ok)throw new Error(`Fetch failed: ${p.statusText}`);const f=await p.blob();if(t.signal.aborted)return;if(d=await createImageBitmap(f),u.push(d),s.push({id:e,imageBitmap:d,width:n,height:a}),l.push(d),(null==h?void 0:h.lowResUrl)&&g){if(t.signal.aborted)return;null==(c=this.publisher)||c.call(this,{id:e,quality:"low",imageUrl:h.lowResUrl,width:h.lowResWidth,height:h.lowResHeight})}}catch(g){if(d){try{d.close()}catch{}const e=u.indexOf(d);e>-1&&u.splice(e,1)}if("AbortError"===g.name)throw g;console.error(`ImageProcessor: Error preparing batch item ${e} (queued):`,g),null==(h=this.onError)||h.call(this,e,g.message||"Batch item preparation failed")}})()):(console.error("Invalid image data in batch (queued):",r),null==(o=this.onError)||o.call(this,e||"unknown-batch","Invalid image data in batch"))}if(await Promise.all(c),t.signal.aborted)throw console.log(`ImageProcessor: Batch ${r} aborted during preparation (queued).`),new DOMException("Batch preparation aborted","AbortError");if(s.length>0){console.log(`ImageProcessor: Sending batch ${r} of ${s.length} images to worker via Comlink (queued).`);const e=await this.proxy.processBatch(P.transfer({images:s},l));if(t.signal.aborted)throw console.log(`ImageProcessor: Batch ${r} aborted after worker completed (queued).`),e.forEach((e=>{e.lowResUrl&&URL.revokeObjectURL(e.lowResUrl),e.highResUrl&&URL.revokeObjectURL(e.highResUrl)})),new DOMException("Batch aborted post-worker","AbortError");console.log(`ImageProcessor: Received ${e.length} results for batch ${r} (queued).`);const o=[];for(const r of e){const{id:e,lowResUrl:t,highResUrl:a}=r,l=s.find((r=>r.id===e)),c=null==l?void 0:l.width,u=null==l?void 0:l.height;if(!c||!u)continue;const h=await this.getCacheEntry(e),d={id:e,lowResUrl:r.lowResUrl??(null==h?void 0:h.lowResUrl),lowResWidth:r.lowResUrl?Math.round(c/4):null==h?void 0:h.lowResWidth,lowResHeight:r.lowResUrl?Math.round(u/4):null==h?void 0:h.lowResHeight,highResUrl:r.highResUrl??(null==h?void 0:h.highResUrl),width:r.highResUrl?c:null==h?void 0:h.width,height:r.highResUrl?u:null==h?void 0:h.height,timestamp:Date.now()};o.push(this.setCacheEntry(d)),r.lowResUrl&&(null==(i=this.publisher)||i.call(this,{id:e,quality:"low",imageUrl:d.lowResUrl,width:d.lowResWidth,height:d.lowResHeight})),r.highResUrl&&(null==(n=this.publisher)||n.call(this,{id:e,quality:"high",imageUrl:d.highResUrl,width:d.width,height:d.height}))}await Promise.all(o)}else console.log(`ImageProcessor: No images needed processing for batch ${r} (queued).`)}catch(d){h=d,"AbortError"===d.name?console.log(`ImageProcessor: Queued batch ${r} processing aborted.`):(console.error(`ImageProcessor: Error processing queued batch ${r}:`,d),null==(a=this.onError)||a.call(this,r,d.message||"Queued batch processing failed"))}finally{("AbortError"===(null==h?void 0:h.name)||h)&&u.forEach((e=>{if(!l.includes(e))try{e.close()}catch{}})),this.activeRequests.delete(r),console.log(`ImageProcessor: Finished queued batch task ${r}. Queue size: ${this.queue.size}`)}})).catch((e=>{var t;console.error(`ImageProcessor: Error adding batch task to queue ${r}:`,e),this.activeRequests.delete(r),null==(t=this.onError)||t.call(this,r,e.message||"Failed to queue batch task")}))}cancel(e){if(e){const r=this.activeRequests.get(e);r?(console.log(`ImageProcessor: Aborting request ${e}.`),r.abort()):console.log(`ImageProcessor: No active request found for ID ${e} to cancel.`)}else console.log(`ImageProcessor: Aborting all ${this.activeRequests.size} active requests and clearing queue.`),this.activeRequests.forEach((e=>e.abort())),this.queue.clear(),this.activeRequests.clear()}cancelAll(){this.cancel()}terminate(){console.log("ImageProcessor: Terminating worker, cancelling active requests, clearing queue, and closing DB."),this.cancelAll();try{this.proxy[P.releaseProxy]()}catch(e){console.warn("ImageProcessor: Error releasing Comlink proxy:",e)}this.worker.terminate(),te&&(oe().then((e=>e.close())),te=null)}}function ne(e){return new Worker("/assets/layoutWorker.worker-BpMaPzBK.js",{name:null==e?void 0:e.name})}function ae(e){return new Worker("/assets/colorExtractor.worker-Cokt-pqW.js",{name:null==e?void 0:e.name})}function se(e){return new Worker("/assets/groupingWorker.worker-CcfMlHni.js",{name:null==e?void 0:e.name})}const le=class e{constructor(){r(this,"imageProcessor",null),r(this,"layoutWorker",null),r(this,"colorExtractorWorker",null),r(this,"groupingWorker",null),r(this,"isImageProcessorInitialized",!1),r(this,"isLayoutWorkerInitialized",!1),r(this,"isColorExtractorInitialized",!1),r(this,"isGroupingWorkerInitialized",!1),r(this,"layoutWorkerListeners",new Map),r(this,"colorExtractorListeners",new Map),r(this,"groupingWorkerListeners",new Map),r(this,"layoutWorkerPromise",null),r(this,"colorExtractorWorkerPromise",null),r(this,"groupingWorkerPromise",null),r(this,"pendingLayoutRequests",new Map),r(this,"pendingColorRequests",new Map),r(this,"pendingGroupingRequests",new Map),r(this,"layoutQueue"),r(this,"colorQueue"),r(this,"groupingQueue"),this.layoutQueue=new q({concurrency:1}),this.groupingQueue=new q({concurrency:1}),this.colorQueue=new q({concurrency:Math.max(1,(navigator.hardwareConcurrency||4)-1)}),console.log(`[WorkerPool] Initialized queues. Concurrency - Layout: ${this.layoutQueue.concurrency}, Grouping: ${this.groupingQueue.concurrency}, Color: ${this.colorQueue.concurrency}`)}static getInstance(){return e.instance||(e.instance=new e),e.instance}initializeWorker(e,r,t){return console.log(`WorkerPool: Initializing ${e} Worker...`),new Promise(((o,i)=>{try{const i=new r;t(i),console.log(`WorkerPool: ${e} Worker initialized successfully.`),o(i)}catch(n){console.error(`[WorkerPool] Failed to initialize ${e} Worker:`,n),i(new Error(`Failed to initialize ${e} Worker`))}}))}getImageProcessor(){var e;return this.imageProcessor||(console.log("WorkerPool: Initializing Image Processor..."),this.imageProcessor=new ie(e),this.isImageProcessorInitialized=!0),this.imageProcessor}cancelPendingImageTasks(){var e,r;this.imageProcessor&&this.isImageProcessorInitialized&&(console.log("WorkerPool: Cancelling pending image processing tasks..."),null==(r=(e=this.imageProcessor).cancel)||r.call(e))}getLayoutWorker(){return this.layoutWorkerPromise||(this.layoutWorkerPromise=this.initializeWorker("layout",ne,(e=>{this.layoutWorker=e,this.setupWorkerMessageHandler(e,"layout",this.pendingLayoutRequests,this.layoutWorkerListeners)})).catch((e=>{throw this.layoutWorkerPromise=null,e}))),this.layoutWorkerPromise}getColorExtractorWorker(){return this.colorExtractorWorkerPromise||(this.colorExtractorWorkerPromise=this.initializeWorker("color",ae,(e=>{this.colorExtractorWorker=e,this.setupWorkerMessageHandler(e,"color",this.pendingColorRequests,this.colorExtractorListeners)})).catch((e=>{throw this.colorExtractorWorkerPromise=null,e}))),this.colorExtractorWorkerPromise}getGroupingWorker(){return this.groupingWorkerPromise||(this.groupingWorkerPromise=this.initializeWorker("grouping",se,(e=>{this.groupingWorker=e,this.setupWorkerMessageHandler(e,"grouping",this.pendingGroupingRequests,this.groupingWorkerListeners)})).catch((e=>{throw this.groupingWorkerPromise=null,e}))),this.groupingWorkerPromise}setupWorkerMessageHandler(e,r,t,o){e.onmessage=e=>{const{data:i}=e,n=i.requestId;if(n&&t.has(n)){const e=t.get(n);clearTimeout(e.timer),"error"===i.type?(console.error(`[WorkerPool] Error response for request ${n} from ${r}:`,i.message),e.reject(new Error(i.message||"Worker returned an error"))):e.resolve(i.payload),t.delete(n)}else n?console.warn(`[WorkerPool] Received message with unknown or stale requestId ${n} from ${r}:`,i):o.forEach((r=>r(e)))},e.onerror=e=>{console.error(`[WorkerPool] Generic error from ${r} Worker:`,e.message,e);const i=new Error(`Worker ${r} encountered an error: ${e.message}`);t.forEach(((e,t)=>{console.warn(`[WorkerPool] Rejecting pending request ${t} due to generic ${r} worker error.`),clearTimeout(e.timer),e.reject(i)})),t.clear(),o.forEach((r=>r(e)))}}postRequest(e,r,t,o){let i,n,a;switch(e){case"layout":i=this.layoutQueue,n=this.pendingLayoutRequests,a=this.getLayoutWorker.bind(this);break;case"color":i=this.colorQueue,n=this.pendingColorRequests,a=this.getColorExtractorWorker.bind(this);break;case"grouping":i=this.groupingQueue,n=this.pendingGroupingRequests,a=this.getGroupingWorker.bind(this);break;default:return Promise.reject(new Error(`Invalid worker type: ${e}`))}return i.add((()=>new Promise((async(i,s)=>{const l=L();let c,u;try{c=await a()}catch(g){return console.error(`[WorkerPool] Failed to initialize worker ${e} for task ${l}:`,g),void s(g)}const h=new Promise(((e,r)=>{n.set(l,{resolve:e,reject:r,timer:u})}));(null==o?void 0:o.timeoutMs)&&(u=setTimeout((()=>{var r;n.has(l)&&(console.warn(`[WorkerPool] Request ${l} to ${e} timed out after ${o.timeoutMs}ms.`),null==(r=n.get(l))||r.reject(new Error(`Request ${l} timed out`)),n.delete(l))}),o.timeoutMs),n.has(l)&&(n.get(l).timer=u));const d={type:r,payload:t,requestId:l};try{c.postMessage(d)}catch(m){return console.error(`[WorkerPool] Error posting message for request ${l} to ${e}:`,m),clearTimeout(u),n.delete(l),void s(m)}try{i(await h)}catch(p){s(p)}finally{clearTimeout(u)}}))),{priority:(null==o?void 0:o.priority)??0})}addLayoutWorkerListener(e,r){console.log(`[WorkerPool] Adding general listener for LayoutWorker: ${e}`),this.layoutWorkerListeners.set(e,r),this.getLayoutWorker()}removeLayoutWorkerListener(e){this.layoutWorkerListeners.has(e)&&(console.log(`[WorkerPool] Removing general listener for LayoutWorker: ${e}`),this.layoutWorkerListeners.delete(e))}addColorExtractorListener(e,r){console.log(`[WorkerPool] Adding general listener for ColorExtractorWorker: ${e}`),this.colorExtractorListeners.set(e,r),this.getColorExtractorWorker()}removeColorExtractorListener(e){this.colorExtractorListeners.has(e)&&(console.log(`[WorkerPool] Removing general listener for ColorExtractorWorker: ${e}`),this.colorExtractorListeners.delete(e))}addGroupingWorkerListener(e,r){console.log(`[WorkerPool] Adding general listener for GroupingWorker: ${e}`),this.groupingWorkerListeners.set(e,r),this.getGroupingWorker()}removeGroupingWorkerListener(e){this.groupingWorkerListeners.has(e)&&(console.log(`[WorkerPool] Removing general listener for GroupingWorker: ${e}`),this.groupingWorkerListeners.delete(e))}cancelPendingLayoutTasks(e=!1){this.cancelTasks("layout",this.layoutQueue,this.pendingLayoutRequests,e)}cancelPendingColorTasks(e=!1){this.cancelTasks("color",this.colorQueue,this.pendingColorRequests,e)}cancelPendingGroupingTasks(e=!1){this.cancelTasks("grouping",this.groupingQueue,this.pendingGroupingRequests,e)}cancelTasks(e,r,t,o=!0){o?(console.log(`[WorkerPool] Cancelling pending tasks and clearing queue for ${e}...`),r.clear(),t.forEach(((r,t)=>{console.warn(`[WorkerPool] Rejecting in-flight request ${t} for ${e} due to cancellation.`),clearTimeout(r.timer),r.reject(new Error(`Request ${t} for ${e} was cancelled.`))})),t.clear()):console.warn("[WorkerPool] Specific request cancellation via ID is not directly supported with queue.clear(). Use cancelAllPendingTasks() or implement AbortSignal.")}cleanup(){var e,r;console.log("WorkerPool: Starting cleanup..."),this.cancelAllPendingTasks(),this.terminateWorker("layout",this.layoutWorker),this.layoutWorker=null,this.layoutWorkerPromise=null,this.layoutWorkerListeners.clear(),this.terminateWorker("color",this.colorExtractorWorker),this.colorExtractorWorker=null,this.colorExtractorWorkerPromise=null,this.colorExtractorListeners.clear(),this.terminateWorker("grouping",this.groupingWorker),this.groupingWorker=null,this.groupingWorkerPromise=null,this.groupingWorkerListeners.clear(),this.imageProcessor&&(console.log("WorkerPool: Cleaning up Image Processor..."),null==(r=(e=this.imageProcessor).terminate)||r.call(e),this.imageProcessor=null),this.layoutQueue.clear(),this.groupingQueue.clear(),this.colorQueue.clear(),console.log("WorkerPool: Cleanup complete.")}terminateWorker(e,r){if(r){console.log(`WorkerPool: Terminating ${e} worker...`);try{r.terminate()}catch(t){console.error(`Error terminating ${e} worker:`,t)}}}cancelAllPendingTasks(){this.cancelPendingImageTasks(),this.cancelPendingLayoutTasks(!0),this.cancelPendingColorTasks(!0),this.cancelPendingGroupingTasks(!0)}};r(le,"instance");let ce=le;const ue="scrollPosition";let he=null;function de(){return he||(he=W("mediaFlowUIScrollDB",1,{upgrade(e){e.objectStoreNames.contains(ue)||e.createObjectStore(ue)}})),he}async function ge(e,r){try{const t=(await de()).transaction(ue,"readwrite"),o=t.objectStore(ue),i={scrollTop:r,timestamp:Date.now()};await o.put(i,e),await t.done}catch(t){console.error("Failed to save scroll state for path:",e,t)}}const me={imageGrid:"_imageGrid_162y8_2",myMasonryGrid:"_myMasonryGrid_162y8_18",myMasonryGridColumn:"_myMasonryGridColumn_162y8_23",imageWrapper:"_imageWrapper_162y8_28",image:"_image_162y8_2",imageTitle:"_imageTitle_162y8_44",smoothTransition:"_smoothTransition_162y8_49",imageFeed:"_imageFeed_162y8_54",imageRow:"_imageRow_162y8_60",visible:"_visible_162y8_65",parallaxLayer:"_parallaxLayer_162y8_92","masked-image-feed":"_masked-image-feed_162y8_101","image-feed":"_image-feed_162y8_108",feedContent:"_feedContent_162y8_140",waterMask:"_waterMask_162y8_148",ripple:"_ripple_162y8_158",rippleOverlay:"_rippleOverlay_162y8_167",container:"_container_162y8_185",feed:"_feed_162y8_140",fadeIn:"_fadeIn_162y8_1",gridContainer:"_gridContainer_162y8_199",loading:"_loading_162y8_205",noImages:"_noImages_162y8_212",imageFeedContainer:"_imageFeedContainer_162y8_228"};var pe=(e=>(e.GRID="grid",e.BANNER="banner",e.MASONRY="masonry",e.CAROUSEL="carousel",e))(pe||{});M.registerPlugin(N);const fe=class e{constructor(){r(this,"targets",new Map),r(this,"timeline"),r(this,"mainTrigger"),this.timeline=M.timeline({paused:!0,smoothChildTiming:!0}),this.mainTrigger=N.create({trigger:document.body,start:"top top",end:"bottom bottom",onUpdate:e=>{this.timeline.progress(e.progress)},markers:!1})}static getInstance(){return e.instance||(e.instance=new e),e.instance}addAnimation(e,r,t){const o=M.to(r,{...t,paused:!0});return this.timeline.add(o,0),this.targets.set(e,{element:r,animation:o}),o}removeAnimation(e){const r=this.targets.get(e);r&&(this.timeline.remove(r.animation),this.targets.delete(e))}cleanup(){this.targets.forEach((({animation:e})=>{e.kill()})),this.mainTrigger&&this.mainTrigger.kill(),this.timeline.kill(),this.targets.clear(),N.getAll().forEach((e=>e.kill()))}};r(fe,"instance");let we=fe;M.registerPlugin(N,U);const ve=class e{constructor(){r(this,"scrollTriggerManager"),this.initializeCustomEases(),this.scrollTriggerManager=we.getInstance()}initializeCustomEases(){U.create("smoothOut","M0,0 C0.126,0.382 0.282,0.674 0.44,0.822 0.632,1.002 0.818,1 1,1"),U.create("gentleIn","M0,0 C0.39,0 0.575,0.565 0.669,0.782 0.762,1 0.846,1 1,1")}static getInstance(){return e.instance||(e.instance=new e),e.instance}getAnimationProperties(e){return{duration:.5,ease:"power2.out",transformOrigin:"center center",scale:1,rotation:0}}createHoverAnimation(e,r){return M.to(e,{scale:1.05,duration:.3,ease:"power2.out",force3D:!0})}createMorphAnimation(e,r){return M.to(e,{duration:.5,borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",ease:"power2.out",force3D:!0})}createScrollAnimation(e,r,t){return this.scrollTriggerManager.addAnimation(r,e,t)}};r(ve,"instance");let ye=ve;const be=e=>{const r=4*(1+.25*((Math.max(.5,Math.min(3,e))-.5)/2.5)),t=Math.round(2*r)/2;return Math.min(Math.max(t,2),12)},ke=e=>{const{containerWidth:r,zoom:t,viewMode:o,isGrouped:i}=e,n=((e,r)=>{const t=e/r,o=Math.floor(t/(200*r));return Math.min(Math.max(o,1),7)})(r,t),a=be(t);return{columns:n,gap:a,minImageWidth:200*t,maxImageWidth:r/n-a}},_e="_particleBackground_1rkmm_1",Re=e=>{let r=0,t=0,o=0;return 4===e.length?(r=parseInt(e[1]+e[1],16),t=parseInt(e[2]+e[2],16),o=parseInt(e[3]+e[3],16)):7===e.length&&(r=parseInt(e[1]+e[2],16),t=parseInt(e[3]+e[4],16),o=parseInt(e[5]+e[6],16)),[r/255,t/255,o/255]},xe=(e,r,t)=>e.map(((e,o)=>e+(r[o]-e)*t)),Ce=(e,r,t)=>e+(r-e)*t,Ie=n.memo((()=>{const e=h(null),r=h(null),o=h(null),i=h(null),n=h({}),a=h({}),s=h(),{dominantColors:c,hoverState:g}=u(Q),m=h(Re(c[0]||"#041024")),p=h(Re(c[1]||c[0]||"#041024")),f=h(c.length>1?1:0),w=h(g.position?[g.position.x,g.position.y]:null),v=h(g.isHovering?1:0),y=l(((e,r,t)=>{const o=e.createShader(r);return o?(e.shaderSource(o,t),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(console.error(`Shader compile error (${r===e.VERTEX_SHADER?"Vertex":"Fragment"}):`,e.getShaderInfoLog(o)),e.deleteShader(o),null)):null}),[]),b=l(((e,r,t)=>{const o=e.createProgram();return o?(e.attachShader(o,r),e.attachShader(o,t),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)?o:(console.error("Program link error:",e.getProgramInfoLog(o)),e.deleteProgram(o),null)):null}),[]),k=l((e=>{const t=r.current,l=o.current;if(!t||!l)return void(s.current=requestAnimationFrame(k));const u=e/1e3,h=.08,d=Re(c[0]||"#041024"),y=Re(c[1]||c[0]||"#041024"),b=c.length>1?1:0;m.current=xe(m.current,d,h),p.current=xe(p.current,y,h),f.current=Ce(f.current,b,h);const _=g.isHovering?1:0;if(v.current=Ce(v.current,_,.16),g.isHovering&&g.position){const e=[g.position.x,g.position.y];w.current?w.current=xe(w.current,e,.16):w.current=e}t.viewport(0,0,t.canvas.width,t.canvas.height),t.useProgram(l),t.bindBuffer(t.ARRAY_BUFFER,i.current);const R=n.current.position;-1!==R&&(t.vertexAttribPointer(R,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(R)),t.uniform2f(a.current.resolution,t.canvas.width,t.canvas.height),t.uniform1f(a.current.time,u),t.uniform3fv(a.current.colorTarget1,m.current),t.uniform3fv(a.current.colorTarget2,p.current),t.uniform1f(a.current.colorMixFactor,f.current),t.uniform1f(a.current.isHovering,v.current>.01?1:0),w.current&&t.uniform2fv(a.current.hoverPos,w.current),t.drawArrays(t.TRIANGLES,0,6),s.current=requestAnimationFrame(k)}),[c,g]);return d((()=>{const t=e.current;if(!t)return;const l=t.getContext("webgl",{alpha:!1,antialias:!0});if(!l)return void console.error("WebGL not supported or context creation failed.");r.current=l;const c=y(l,l.VERTEX_SHADER,"\n  precision mediump float;\n  attribute vec2 a_position; // Vertex position (-1 to 1)\n  varying vec2 v_uv;         // Pass UV coordinates (0 to 1) to fragment shader\n\n  void main() {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    v_uv = (a_position + 1.0) * 0.5; // Convert clip space to UV space\n    v_uv.y = 1.0 - v_uv.y; // Flip Y for texture/canvas coordinate system\n  }\n"),u=y(l,l.FRAGMENT_SHADER,"\n  precision mediump float;\n  varying vec2 v_uv; // UV coordinates from vertex shader\n\n  uniform vec2 u_resolution;    // Canvas resolution\n  uniform float u_time;        // Time for animations\n  uniform vec3 u_colorTarget1;  // Base color 1\n  uniform vec3 u_colorTarget2;  // Base color 2\n  uniform float u_colorMixFactor; // Mix factor for base colors\n\n  // Hover state uniforms\n  uniform bool u_isHovering;\n  uniform vec2 u_hoverPos;      // Normalized hover position (0-1)\n  uniform vec3 u_hoverColor;    // Optional: Color associated with hover\n\n  // --- Noise Functions ---\n  // Simple pseudo-random number generator\n  float random (vec2 st) {\n      // Adjusted seed based on example, can be tweaked\n      return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);\n  }\n\n  // Basic Value Noise function\n  float noise (vec2 st) {\n      vec2 i = floor(st); // Integer part\n      vec2 f = fract(st); // Fractional part\n\n      // Get random values for the 4 corners surrounding the point\n      float a = random(i);\n      float b = random(i + vec2(1.0, 0.0));\n      float c = random(i + vec2(0.0, 1.0));\n      float d = random(i + vec2(1.0, 1.0));\n\n      // Smoothly interpolate between the corner values (smoothstep)\n      vec2 u = f * f * (3.0 - 2.0 * f);\n      // Interpolate horizontally, then vertically\n      return mix(mix(a, b, u.x), mix(c, d, u.x), u.y);\n  }\n\n  // Fractional Brownian Motion (fBm) - layering noise\n  #define OCTAVES 4 // Number of noise layers (adjust for detail/performance)\n  float fbm (vec2 st) {\n      float value = 0.0;\n      float amplitude = 0.5;\n      float frequency = 0.0;\n      // Loop through octaves, adding noise at different frequencies/amplitudes\n      for (int i = 0; i < OCTAVES; i++) {\n          value += amplitude * noise(st);\n          st *= 2.0; // Double frequency for next octave\n          amplitude *= 0.5; // Halve amplitude for next octave\n      }\n      return value;\n  }\n  // --- End Noise Functions ---\n\n  // Function to calculate distance from hover point (same as before)\n  float getHoverDist(vec2 pos) {\n    float aspectRatio = u_resolution.x / u_resolution.y;\n    vec2 diff = pos - u_hoverPos;\n    diff.x *= aspectRatio;\n    return distance(vec2(0.0), diff);\n  }\n\n  void main() {\n    // --- Calculate Base Aura Color using Noise ---\n    // Scale UV and add time for animation. Adjust scale (e.g., * 3.0) for noise detail.\n    vec2 noisyCoord = v_uv * 2.5 + vec2(u_time * 0.02, u_time * 0.03); // Slow movement\n    float noisePattern = fbm(noisyCoord);\n\n    // Base color blend - mix between target colors\n    vec3 baseColor = mix(u_colorTarget1, u_colorTarget2, u_colorMixFactor);\n\n    // Modulate the base color blend using the noise pattern\n    // Mix based on noise value AND vertical position for variety\n    vec3 auraColor = mix(baseColor, mix(u_colorTarget1, u_colorTarget2, v_uv.y * 0.8 + 0.1), noisePattern * 0.6);\n    // Add subtle contrast/brightness variation based on noise\n    auraColor *= (0.9 + noisePattern * 0.2);\n\n    // --- Hover Effect (Applied on top of aura) ---\n    vec3 finalColor = auraColor;\n    if (u_isHovering) {\n      float dist = getHoverDist(v_uv);\n      // Ripple/glow effect - use smoothstep for soft edges\n      float hoverIntensity = smoothstep(0.20, 0.0, dist); // Increased radius slightly\n\n      // Make the glow slightly colored (e.g., whitish or based on u_hoverColor if available)\n      vec3 glowColor = vec3(0.8, 0.8, 0.9); // Whitish glow\n      // Optionally use u_hoverColor: mix(glowColor, u_hoverColor, 0.5)\n\n      // Additive blend for glow, stronger near center\n      finalColor += glowColor * hoverIntensity * 0.6; // Adjust intensity multiplier\n\n      // Optional: Slight displacement/warp effect (more complex)\n      // vec2 displacement = normalize(v_uv - u_hoverPos) * hoverIntensity * 0.01;\n      // Recalculate noise/color at v_uv - displacement ? (performance cost)\n    }\n\n    // Ensure color values stay within valid range\n    gl_FragColor = vec4(clamp(finalColor, 0.0, 1.0), 1.0);\n  }\n");if(!c||!u)return;const h=b(l,c,u);if(!h)return;o.current=h,l.detachShader(h,c),l.detachShader(h,u),l.deleteShader(c),l.deleteShader(u);const d=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);i.current=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,i.current),l.bufferData(l.ARRAY_BUFFER,d,l.STATIC_DRAW),n.current.position=l.getAttribLocation(h,"a_position"),a.current.resolution=l.getUniformLocation(h,"u_resolution"),a.current.time=l.getUniformLocation(h,"u_time"),a.current.colorTarget1=l.getUniformLocation(h,"u_colorTarget1"),a.current.colorTarget2=l.getUniformLocation(h,"u_colorTarget2"),a.current.colorMixFactor=l.getUniformLocation(h,"u_colorMixFactor"),a.current.isHovering=l.getUniformLocation(h,"u_isHovering"),a.current.hoverPos=l.getUniformLocation(h,"u_hoverPos"),a.current.hoverColor=l.getUniformLocation(h,"u_hoverColor");const g=new ResizeObserver((e=>{if(!e||0===e.length)return;const{width:t,height:o}=e[0].contentRect;r.current&&(r.current.canvas.width=t,r.current.canvas.height=o)}));return g.observe(t),s.current=requestAnimationFrame(k),()=>{s.current&&cancelAnimationFrame(s.current),g.disconnect();const e=r.current;e&&(i.current&&e.deleteBuffer(i.current),o.current&&e.deleteProgram(o.current)),r.current=null,o.current=null,i.current=null}}),[y,b,k]),t("canvas",{ref:e,className:_e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",pointerEvents:"none",zIndex:-1}})})),Ee="_imageRow_1tgys_1",Pe="_imageWrapper_1tgys_26",$e={imageContainer:"_imageContainer_1tb1b_1",imageWrapper:"_imageWrapper_1tb1b_17",image:"_image_1tb1b_1",imageTitle:"_imageTitle_1tb1b_38",groupCounter:"_groupCounter_1tb1b_57",carouselIndicator:"_carouselIndicator_1tb1b_75",loading:"_loading_1tb1b_96",shimmer:"_shimmer_1tb1b_1",imageItem:"_imageItem_1tb1b_107",imageSkeleton:"_imageSkeleton_1tb1b_121",gradientBG:"_gradientBG_1tb1b_1",skeletonGridContainer:"_skeletonGridContainer_1tb1b_143"};function We(e){if(!e)return"Untitled";const r=e.replace(/\.(preview|thumbnail|jpg|jpeg|png|gif|webp)/gi,"").replace(/[-_.](v\d+|example|intro|concept)[-_.]?\d*/gi,"").replace(/[-_.]?(flux|lora|ai|toolkit|preview|example\d*|poster)[-_.]?/gi," ").replace(/\.\d+$/,"").replace(/[-_.]?\d{6,}[-_.]?/g,"").replace(/(\d)[-_.](\d)/g,"$1$2").replace(/\s+\d+$/,"").replace(/[-_.]+/g," ").replace(/\s+/g," ").split(" ").map((e=>e.match(/^[A-Z]{2,}$/)?e:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" ").trim();return r.length>30?r.substring(0,30)+"...":r}const qe=n.forwardRef((({src:e,alt:r,width:o,isProcessed:i,onLoad:n,onError:a,className:c,style:u},h)=>{const[g,m]=s(!1);d((()=>{m(!1)}),[e]);const p=l((()=>{m(!0),n()}),[n]),f=l((()=>{m(!1),a()}),[a]),v=!i&&o&&!e.startsWith("blob:"),y=v?[`${e}&w=${Math.round(o)} 1x`,`${e}&w=${Math.round(2*o)} 2x`,`${e}&w=${Math.round(3*o)} 3x`].join(", "):void 0,b=v?`${Math.round(o)}px`:void 0;return t(w.img,{ref:h,src:e,alt:r,className:c,loading:"lazy",style:{display:"block",width:"100%",height:"100%",objectFit:"cover",position:"absolute",top:0,left:0,...u},initial:{opacity:0},animate:{opacity:g?1:0},transition:{duration:.4,ease:"easeIn"},onLoad:p,onError:f,srcSet:y,sizes:b},e)}));qe.displayName="ResponsiveImage";const Le=g((({image:e,onClick:r,containerWidth:i,containerHeight:n,zoom:a=1,groupCount:u,onResize:g,width:m,height:p,isCarousel:f=!1,groupImages:w=[],onImageHover:v,onImageLoadError:y,dominantColor:b})=>{const k=h(null),_=h(null),[R,x]=s(!1),[C,I]=s({}),[E,P]=s(!1),[$,W]=s(!1),[q,L]=s(!1),{subscribeToImageUpdates:M}=Y(),U=c((()=>b||"#333"),[b]),N=i,T=n,S=c((()=>e.width&&e.height&&e.width>0&&e.height>0?`${e.width} / ${e.height}`:N>0&&T>0?`${N} / ${T}`:"1 / 1"),[e.width,e.height,N,T]);d((()=>{g&&g(N,T)}),[N,T,g]);const F=l((()=>{if(_.current){const r=_.current.getBoundingClientRect(),t=r.left+r.width/2,o=r.top+r.height/2,i=t/window.innerWidth,n=o/window.innerHeight;v({isHovering:!0,position:{x:i,y:n},color:b||null,imageId:e.id})}}),[v,e.id,b]),A=l((()=>{v({isHovering:!1,position:null,color:null,imageId:e.id})}),[v,e.id]),z=l((r=>{console.log(`[ImageItem ${e.id}] Received processed data via context: ${r.quality}`),I((e=>({...e,[r.quality]:r.imageUrl}))),"low"===r.quality&&W(!0),"high"===r.quality&&L(!0)}),[e.id]);d((()=>{const r=M(e.id,z);return()=>{r()}}),[e.id,M,z]),d((()=>{const r=C.low,t=C.high;r&&(console.log(`[ImageItem ${e.id}] Revoking low-res blob URL on unmount: ${r}`),URL.revokeObjectURL(r)),t&&(console.log(`[ImageItem ${e.id}] Revoking high-res blob URL on unmount: ${t}`),URL.revokeObjectURL(t))}),[]);const H=c((()=>C.high?C.high:C.low?C.low:e.src),[C.high,C.low,e.src]),G=!(!C.high&&!C.low),B=$||q||!E&&H,j=l((()=>{(C.high||!$&&!q)&&x(!0),P(!1)}),[C.high,$,q]),D=l((()=>{P(!0),y(e.id)}),[e.id,y]);return c((()=>We(e.alt||e.title||"Untitled")),[e.alt,e.title]),E?null:o("div",{ref:_,className:$e.imageItemContainer,onClick:()=>!E&&r(e),onMouseEnter:F,onMouseLeave:A,style:{width:`${N}px`,height:`${T}px`,aspectRatio:S,position:"relative",overflow:"hidden",cursor:E?"not-allowed":"pointer",backgroundColor:U},children:[B&&t(qe,{ref:k,src:H,alt:e.alt||e.id,width:N,isProcessed:G,onLoad:j,onError:D,className:$e.imageElement},H),E&&t("div",{className:$e.errorOverlay,children:t("span",{children:"Error"})}),t("div",{className:$e.titleOverlay,children:We(e.alt||e.id)}),u&&u>1&&t("div",{className:$e.groupIndicator,children:u})]})})),Me={type:"spring",stiffness:120,damping:30,mass:1},Ue={hidden:{opacity:0,scale:.95},visible:e=>({opacity:1,scale:1,transition:{delay:.03*e,duration:.3,ease:"easeOut"}})},Ne=n.memo((({images:e,imageWidths:r,onImageClick:o,columns:i,zoom:n,isLastRow:a,rowHeight:s,groupedImages:l,workerPool:c,gap:u,containerWidth:d,onImageHover:g,onImageLoadError:m,dominantColorMap:p})=>{const f=h(null),y=v();return!e||0===e.length||!r||r.length!==e.length||s<=0?null:t(w.div,{ref:f,className:Ee,animate:y,initial:!1,style:{display:"flex",flexWrap:"nowrap",overflow:"hidden",gap:`${u}px`,height:`${s}px`,marginBottom:`${u}px`,position:"relative",willChange:"transform",width:"100%",maxWidth:`${d}px`,justifyContent:"flex-start",alignItems:"stretch"},layout:!0,transition:Me,children:e.map(((e,i)=>{const a=l.find((r=>r.images.some((r=>r.id===e.id)))),c=r[i];if(void 0===c||c<=0)return console.warn(`Invalid width (${c}) calculated for image ${e.id} at index ${i}`),null;const u=null==p?void 0:p.get(e.id);return t(w.div,{className:Pe,custom:i,initial:"hidden",animate:"visible",variants:Ue,style:{width:`${c}px`,height:`${s}px`,flexShrink:0,flexGrow:0,position:"relative",overflow:"hidden"},layout:!0,transition:Me,children:t(Le,{image:e,onClick:()=>o(e),containerWidth:c,containerHeight:s,width:c,height:s,zoom:n,isCarousel:(null==a?void 0:a.isCarousel)||!1,groupImages:(null==a?void 0:a.images)||[],onImageHover:g,onImageLoadError:m,dominantColor:u})},e.id)}))})})),Te=({containerWidth:e,containerHeight:r,placeholderColor:o})=>t("div",{className:`${$e.imageItem} ${$e.imageSkeleton}`,style:{width:e,height:r,maxWidth:"100%",maxHeight:"100%",aspectRatio:`${e} / ${r}`,...o?{backgroundColor:o}:{}},children:t("div",{className:$e.skeletonAnimation})}),Se=({images:e,zoom:r})=>e.length?t("div",{className:"banner-view space-y-4",children:e.map(((e,i)=>t(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1*i},className:"banner-item relative",children:o("div",{className:"banner-image-container w-full h-[300px] rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300",style:{height:300*r+"px"},children:[t("img",{src:e.src,alt:e.alt,className:"w-full h-full object-cover"}),o("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4",children:[t("h3",{className:"text-white text-lg font-semibold",children:e.title}),o("p",{className:"text-white/80 text-sm",children:[e.width," × ",e.height]})]})]})},e.id)))}):t("div",{className:"text-center text-gray-500 mt-8",children:"No images to display"}),Fe=e=>{const{onClick:r}=e;return t("button",{onClick:r,className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors duration-300",children:t(S,{})})},Ae=e=>{const{onClick:r}=e;return t("button",{onClick:r,className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-colors duration-300",children:t(F,{})})},ze=({images:e,zoom:r})=>{if(!e.length)return t("div",{className:"text-center text-gray-500 mt-8",children:"No images to display"});return t("div",{className:"carousel-view",children:t(T,{...{dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:t(Fe,{}),prevArrow:t(Ae,{}),adaptiveHeight:!0,customPaging:e=>t("div",{className:"w-3 h-3 mx-1 rounded-full bg-white/50 hover:bg-white/70 transition-colors duration-300"})},children:e.map(((e,i)=>t(w.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"outline-none",children:o("div",{className:"relative aspect-video",children:[t("img",{src:e.src,alt:e.alt,className:"w-full h-full object-contain",style:{maxHeight:600*r+"px"}}),o("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4",children:[t("h3",{className:"text-white text-lg font-semibold",children:e.title}),o("p",{className:"text-white/80 text-sm",children:[e.width," × ",e.height]})]})]})},e.id)))})})},He=({images:e,zoom:r})=>e.length?t(z,{breakpointCols:{default:4,1536:4,1280:3,1024:3,768:2,640:1},className:"flex -ml-4 w-auto",columnClassName:"pl-4 bg-clip-padding",children:e.map(((e,i)=>t(w.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.1*i},className:"mb-4",children:o("div",{className:"relative group rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-shadow duration-300",children:[t("img",{src:e.src,alt:e.alt,className:"w-full h-auto",style:{maxHeight:400*r+"px",objectFit:"cover"}}),o("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300",children:[t("h3",{className:"text-white text-lg font-semibold",children:e.title}),o("p",{className:"text-white/80 text-sm",children:[e.width," × ",e.height]})]})]})},e.id)))}):t("div",{className:"text-center text-gray-500 mt-8",children:"No images to display"});const Ge=n.memo((({folderPath:e,isGrouped:r,zoom:i,viewMode:n,scrollContainerRef:a})=>{const{data:g,isLoading:p,isError:v,error:C,isPlaceholderData:I}=ee(e);!function(){const[e,r]=s({width:window.innerWidth,height:window.innerHeight}),t=l((()=>{const t=window.innerWidth,o=window.innerHeight;t===e.width&&o===e.height||requestAnimationFrame((()=>{r({width:t,height:o})}))}),[e.width,e.height]);d((()=>{let e=null;function r(){e&&clearTimeout(e),e=setTimeout(t,150)}return t(),window.addEventListener("resize",r),()=>{e&&clearTimeout(e),window.removeEventListener("resize",r)}}),[t])}();const P=h(null),[$,W]=s(0),[q,L]=s(4),[M,U]=s(-1),[N,T]=s([]);c((()=>ye.getInstance()),[]);const{setDominantColors:S,setHoverState:F}=u(Q),[A,z]=s(new Map),H=h(new Set),G=h(null),[B,j]=s(null),D=h(null),O=h([]),V=h(!1),Z=h(0),[K,X]=s(3),[J,re]=s(new Set),{publishImageUpdate:te}=Y(),oe=l((e=>{let r=e.replace(/\\/g,"/");return r.startsWith("/api/image/")||r.startsWith("/")?r:`/api/image/${r}`}),[]),ie=c((()=>g?g.filter((e=>e&&!J.has(e.id))):[]),[g,J]),ne=l((e=>{re((r=>{if(r.has(e))return r;console.log(`ImageFeed: Registering error for image ${e}`);const t=new Set(r);return t.add(e),t}))}),[]),ae=c((()=>ce.getInstance()),[]),[se,le]=s([]),[he,fe]=s(!1),[we,ve]=s([]),[_e,Re]=s(!1),xe=h({}),Ce=c((()=>{const e=new Map;let r=0;const t=be(i);return se.forEach((o=>{let i=0;o.images.forEach(((n,a)=>{if(!o.imageWidths||o.imageWidths.length<=a)return void console.warn(`[ImageFeed] Missing imageWidths for image ${n.id} in row.`);const s=o.imageWidths[a];e.set(n.id,{top:r,left:i,width:s,height:o.height}),i+=s+t})),r+=o.height+t})),e}),[se,i]);!function({scrollContainerRef:e,imageList:r,layoutData:t,lookaheadDistance:o=600,concurrency:i=3,throttleDelay:n=100}){const a=ce.getInstance().getImageProcessor(),[u,g]=s({top:0,bottom:0,height:0}),m=h(new Set),p=h(),f=l((()=>{const r=e.current;if(!r)return;const{scrollTop:t,clientHeight:o}=r,i=t,n=t+o;g((e=>({top:i,bottom:n,height:o})))}),[e]),w=l(((e,r)=>{const t=r.top+r.height/2,o=u.top+u.height/2;return Math.abs(t-o)}),[u]),v=l((async()=>{const n=u;if(!e.current||0===r.length||0===t.size)return;const s=[],l=Math.max(0,n.top-o),c=n.bottom+o;for(const e of r){const r=t.get(e.id);if(!r)continue;const o=r.top;if(r.top+r.height>=l&&o<=c){const t=w(e,r);s.push({...e,priority:t,layout:r})}}s.sort(((e,r)=>e.priority-r.priority));let h=0;for(const e of s){if(h>=i)break;m.current.has(e.id)||(console.log(`[PrefetchManager] Requesting process for ${e.id}, Priority: ${e.priority.toFixed(0)}`),m.current.add(e.id),h++,a.processImage(e).catch((r=>{console.error(`[PrefetchManager] Error processing ${e.id}:`,r)})).finally((()=>{m.current.delete(e.id)})))}}),[r,t,o,i,a,w,e]);d((()=>{p.current=v}),[v]);const y=c((()=>E((()=>{p.current&&p.current()}),n)),[n]);d((()=>{f();const r=e.current;return r&&r.addEventListener("scroll",y,{passive:!0}),()=>{y.cancel(),r&&r.removeEventListener("scroll",y)}}),[e,f,y]),d((()=>{var e;r.length>0&&t.size>0&&(console.log("[PrefetchManager] Running logic due to imageList/layoutData change."),null==(e=p.current)||e.call(p))}),[r,t])}({scrollContainerRef:a,imageList:ie,layoutData:Ce});const[Ee,Pe]=s(r),$e=l(y((e=>{Pe(e),console.log("[ImageFeed] Applying debounced isGrouped:",e)}),300),[]);d((()=>($e(r),()=>$e.cancel())),[r,$e]);const We=l(function(e,r){let t=null;const o=(...o)=>{null!==t&&clearTimeout(t),t=setTimeout((()=>e(...o)),r)};return o.cancel=()=>{null!==t&&(clearTimeout(t),t=null)},o}(((e,r)=>{e&&!V.current&&ge(e,r)}),500),[]);d((()=>{let r=!0;(async()=>{const t=await async function(e){try{const r=(await de()).transaction(ue,"readonly"),t=r.objectStore(ue),o=await t.get(e);return await r.done,o??null}catch(C){return console.error("Failed to load scroll state for path:",e,C),null}}(e);r&&(t?(j(t),V.current=!0):(j(null),a.current&&(a.current.scrollTop=0),V.current=!1))})();const t=e;return D.current=t,()=>{var e;r=!1;const t=a.current,o=D.current;t&&o&&O.current.length>0&&ge(o,t.scrollTop),null==(e=We.cancel)||e.call(We),console.log("ImageFeed: Unmounting, cancelling all pending worker tasks."),ae.cancelAllPendingTasks()}}),[e,a,We,ae]);const qe=c((()=>{if(!g||0===g.length)return 1;const e=g.filter((e=>e&&e.width>0&&e.height>0));if(0===e.length)return 1;return e.reduce(((e,r)=>e+r.width/r.height),0)/e.length}),[g]),Le=c((()=>{const e=be(i);let r=200;if($>0&&q>0&&qe>0){const t=Math.max(0,q-1)*e,o=Math.max(0,$-t);if(o>0){const e=o/q;r=Math.max(50,Math.round(e/qe))}}return{gapSize:e,estimatedRowHeightFallback:r}}),[$,q,i,qe]);d((()=>{U(-1),T([]),z(new Map),H.current.clear(),re(new Set),le([]),fe(!1),ve([]),Re(!1),console.log(`ImageFeed: Deps changed (${e}/${n}/${r}/${i}), cancelling pending worker tasks.`),ae.cancelAllPendingTasks(),xe.current={}}),[e,n,r,i,ae]);const Me=l((()=>{if(!P.current)return;const e=P.current.getBoundingClientRect(),r=Math.max(200,e.width);W((e=>{if(r!==e){const e=ke({containerWidth:r,zoom:i,viewMode:n,isGrouped:Ee});return L(e.columns),r}return e}))}),[i,n,Ee]);m((()=>{Me()}),[Me]),d((()=>{const e=new ResizeObserver(Me);return P.current&&e.observe(P.current),window.addEventListener("resize",Me),()=>{e.disconnect(),window.removeEventListener("resize",Me)}}),[Me]),d((()=>{if(ie&&ie.length>0&&!p){const e=Math.min(ie.length,30);console.log(`[ImageFeed] Pre-fetching colors for initial ${e} images...`);for(let r=0;r<e;r++){const e=ie[r];if(e&&e.id&&e.src&&!A.has(e.id)&&!H.current.has(e.id)){const r=oe(e.src);H.current.add(e.id),ae.postRequest("color","extractColor",{id:e.id,src:r},{priority:2}).then((e=>{})).catch((e=>{})).finally((()=>{H.current.delete(e.id)}))}}}}),[ie,p,ae,oe]),d((()=>{if(!ie||0===ie.length||xe.current.grouping)return ve([]),void Re(!1);(async()=>{console.log("[ImageFeed] Requesting grouping calculation..."),Re(!0),xe.current.grouping=!0;try{const e=await ae.postRequest("grouping","groupImages",{images:ie,isGrouped:Ee},{priority:9});xe.current.grouping&&(console.log("[ImageFeed] Received grouping result:",e.groupedImages.length,"groups"),ve(e.groupedImages))}catch(e){console.error("[ImageFeed] Grouping worker request failed:",e),ve([])}finally{xe.current.grouping&&(Re(!1),xe.current.grouping=!1)}})()}),[ie,Ee,ae]),d((()=>{if(n!==pe.GRID||0===we.length||$<=0||xe.current.layout)return le([]),void fe(!1);const e=we.map((e=>e.images[0])).filter((e=>e&&e.width>0&&e.height>0));if(0===e.length)return le([]),void fe(!1);(async()=>{console.log("[ImageFeed] Requesting layout calculation..."),fe(!0),xe.current.layout=!0;try{const r=await ae.postRequest("layout","calculateLayout",{images:e,containerWidth:$,zoom:i,targetRowHeight:Le.estimatedRowHeightFallback},{priority:10});xe.current.layout&&(console.log("[ImageFeed] Received layout result:",r.length,"rows"),le(r))}catch(r){console.error("[ImageFeed] Layout worker request failed:",r),le([])}finally{xe.current.layout&&(fe(!1),xe.current.layout=!1)}})()}),[we,$,i,n,Le.estimatedRowHeightFallback,ae]),d((()=>{n===pe.GRID&&se&&se.length>0?O.current=se.map((e=>e.height)):O.current=[]}),[se,n,e]),l((e=>{console.warn("Image overflow detected:",e.id)}),[]);const Ue=l((e=>{const r=we.findIndex((r=>r.images.some((r=>r.id===e.id))));if(-1!==r){const t=we[r],o=t.images.findIndex((r=>r.id===e.id));-1!==o&&(T(t.images),U(o))}}),[we]),Fe=h(0),Ae=h(performance.now()),Ge=l((()=>{const r=a.current;if(!r)return;const t=performance.now(),o=r.scrollTop,i=t-Ae.current,n=o-Fe.current;if(i>10){const r=Math.abs(n)/i;Z.current=.2*r+.8*Z.current;const a=3+Math.min(10*Z.current,12);X(Math.round(a)),Fe.current=o,Ae.current=t,We(e,o)}}),[a,e,We]);d((()=>{const e=a.current;if(e){const r=function(e,r){let t;return function(...o){const i=this;t||(t=!0,setTimeout((()=>t=!1),r),e.apply(i,o))}}(Ge,100);return e.addEventListener("scroll",r),()=>e.removeEventListener("scroll",r)}}),[a,Ge]);const Be=f({count:se.length,getScrollElement:()=>a.current,estimateSize:l((e=>{var r;return((null==(r=se[e])?void 0:r.height)??Le.estimatedRowHeightFallback)+Le.gapSize}),[se,Le.estimatedRowHeightFallback,Le.gapSize]),overscan:K});m((()=>{var e;null==(e=Be.measure)||e.call(Be)}),[i,$,se.length,Le.estimatedRowHeightFallback,Le.gapSize,n,Ee,e,Be]);const je=Be.getVirtualItems();m((()=>{const e=a.current;V.current&&B&&O.current.length>0&&(e?(console.log(`Restoring scroll to: ${B.scrollTop}`),requestAnimationFrame((()=>{e.scrollTop=B.scrollTop,V.current=!1}))):V.current=!1)}),[B,a,je,e]);const De=l((e=>{G.current&&(clearTimeout(G.current),G.current=null),e.isHovering?G.current=setTimeout((()=>{const r=A.get(e.imageId)||null;F({isHovering:!0,position:e.position,color:r})}),150):F({isHovering:!1,position:null,color:null})}),[F,A]);d((()=>()=>{G.current&&clearTimeout(G.current)}),[]),d((()=>{if(0===je.length||0===se.length||0===ie.length)return;const e=new Set;je.forEach((r=>{const t=se[r.index];null==t||t.images.forEach((r=>e.add(r.id)))}));const r=[];if(e.forEach((e=>{if(!A.has(e)&&!H.current.has(e)){const t=ie.find((r=>r.id===e));if(null==t?void 0:t.src){const o=oe(t.src);H.current.add(e);const i=ae.postRequest("color","extractColor",{id:t.id,src:o},{priority:1}).then((e=>{if(e&&"string"==typeof e.color){const r=e.color;z((t=>{const o=new Map(t);return o.set(e.id,r),o}))}})).catch((r=>{console.error(`[ImageFeed] Color worker request failed for image ID ${e}:`,r)})).finally((()=>{H.current.delete(e)}));r.push(i)}}})),r.length>0)Promise.allSettled(r).then((()=>{const e=[];je.forEach((r=>{const t=se[r.index];null==t||t.images.forEach((r=>{const t=A.get(r.id);t&&e.push(t)}))})),e.length>0?S(e.slice(0,2)):S([])}));else{const e=[];je.forEach((r=>{const t=se[r.index];null==t||t.images.forEach((r=>{const t=A.get(r.id);t&&e.push(t)}))})),e.length>0?S(e.slice(0,2)):S([])}}),[ae,je,se,ie,oe,A,S]),d((()=>{const e=ae.getImageProcessor();e&&"function"==typeof e.setPublisher?e.setPublisher(te):console.warn("[ImageFeed] ImageProcessor instance not found or setPublisher method missing.")}),[ae,te]);const Oe=c((()=>[k,_,R,x]),[]),Qe=c((()=>N.length?N.map((e=>({src:oe(e.src),alt:e.alt,title:e.title,width:e.width,height:e.height}))):[]),[N,oe]);if(v)return o("div",{ref:P,className:`${me.container} ${me.error}`,children:["Error loading images: ",(null==C?void 0:C.message)||"Unknown error"]});return!!(p||ie&&0!==ie.length)||_e||he?o("div",{ref:P,className:me.container,style:{position:"relative"},children:[t(Ie,{}),t("div",{className:me.feed,children:(()=>{const{gapSize:e}=Le;if(!$)return null;const r=p||_e||n===pe.GRID&&he;if(r&&n===pe.GRID)return t("div",{className:me.gridContainer,style:{gap:`${e}px`,display:"grid",gridTemplateColumns:`repeat(${q}, minmax(0, 1fr))`,padding:e/2},children:(ie??[]).map((e=>{if(!e||e.width<=0||e.height<=0)return null;const r=A.get(e.id);return t(Te,{containerWidth:e.width,containerHeight:e.height,placeholderColor:r},`skeleton-${e.id}`)}))});if(n!==pe.GRID){let e;switch(n){case pe.MASONRY:e=He;break;case pe.BANNER:e=Se;break;case pe.CAROUSEL:e=ze;break;default:return null}return t(e,{images:ie,zoom:i})}return!r&&se.length>0?t("div",{style:{height:`${Be.getTotalSize()}px`,width:"100%",position:"relative"},children:t("div",{style:{width:"100%",position:"relative"},children:je.map((r=>{const o=se[r.index];return o?t(w.div,{layout:!0,transition:{type:"spring",stiffness:260,damping:30},"data-index":r.index,ref:Be.measureElement,style:{position:"absolute",top:0,left:0,width:"100%",height:r.size,y:r.start},children:t(Ne,{images:o.images,imageWidths:o.imageWidths??[],onImageClick:Ue,columns:q,zoom:i,isLastRow:r.index===se.length-1,rowHeight:o.height,groupedImages:we,workerPool:ae,gap:e,containerWidth:$,onImageHover:De,onImageLoadError:ne,dominantColorMap:A})},r.key):null}))})}):null})()}),t(b,{open:-1!==M,close:()=>U(-1),index:M,slides:Qe,plugins:Oe})]}):t("div",{ref:P,className:me.container,children:t(w.div,{initial:{opacity:0},animate:{opacity:1},className:me.noImages,children:"No images found for this folder."})})})),Be=({selectedFolder:e,isGrouped:r,zoom:o,viewMode:i,scrollContainerRef:n})=>t("div",{className:`${B} flex flex-col h-full bg-transparent`,children:t("div",{className:`${j} flex-1`,children:t(Ge,{folderPath:e,isGrouped:r,zoom:o,viewMode:i,scrollContainerRef:n})})}),je=({selectedFolder:e,searchQuery:r,zoom:o,isGrouped:n,viewMode:a,scrollContainerRef:s})=>t(i,{children:t(Be,{selectedFolder:e,zoom:o,isGrouped:n,viewMode:a,scrollContainerRef:s})}),De="_navbar_1wwjh_2",Oe="_leftSection_1wwjh_10",Qe="_rightSection_1wwjh_15",Ve="_navbarBackground_1wwjh_19",Ze="_viewToggleButton_1wwjh_46",Ye="_viewModeButtons_1wwjh_57",Ke="_viewModeButton_1wwjh_57",Xe="_active_1wwjh_75";const Je=()=>{const{data:e,isLoading:r,isError:i}=C({queryKey:["currentDirectory"],queryFn:J,staleTime:18e5,refetchOnWindowFocus:!1});let n="...",a="bg-gray-600 text-gray-400 cursor-not-allowed",s="text-gray-500";return i?(n="Error",a="bg-red-800 text-red-200 cursor-not-allowed",s="text-red-400"):!r&&e&&(n=e,a="bg-gray-700 text-peach hover:bg-gray-600",s="text-yellow-500"),o(w.button,{className:`flex items-center px-3 py-1 rounded-md text-sm transition-all duration-300 ease-in-out ${a}`,whileHover:r||i?{}:{scale:1.05},whileTap:r||i?{}:{scale:.95},disabled:r||i,children:[t(H,{size:16,className:`mr-2 ${s}`}),t(w.div,{className:"truncate max-w-xs",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:t("span",{children:n})})]})},er="_searchBarContainer_3g2eh_1",rr="_searchBackground_3g2eh_19",tr="_searchInput_3g2eh_41",or=({onSearch:e})=>{const[r,i]=s("");v();return o(w.form,{onSubmit:t=>{t.preventDefault(),e(r)},className:er,initial:{width:"200px"},animate:{width:r?"300px":"200px"},transition:{type:"spring",stiffness:300,damping:30},children:[t(w.div,{className:rr,animate:{background:r?"linear-gradient(90deg, #4a00e0 0%, #8e2de2 100%)":"rgba(255, 255, 255, 0.1)"}}),t(w.input,{type:"text",value:r,onChange:e=>i(e.target.value),className:tr,placeholder:"Search the future...",whileFocus:{scale:1.05},transition:{type:"spring",stiffness:400,damping:30}})]})},ir=({zoom:e,onZoomChange:r})=>{const[i,n]=s(!1),a=v(),l=(e-.5)/1.5*100+"%",c=i?1:.6,u=i?1.1:1;return d((()=>{a.start({scale:i?1.05:1,transition:{type:"spring",stiffness:300,damping:20}})}),[i,a]),o(w.div,{className:"relative flex items-center bg-gray-800/80 backdrop-blur-md rounded-full p-3 overflow-hidden",style:{boxShadow:"0 4px 12px rgba(0,0,0,0.1)",width:"200px"},animate:a,children:[o(w.div,{className:"relative",whileHover:{scale:1.2},whileTap:{scale:.95},onClick:()=>r(Math.max(.5,e-.1)),children:[t(w.svg,{className:"text-gray-200 mr-3 cursor-pointer",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",whileHover:{rotate:-90},transition:{duration:.3},children:t("path",{d:"M21 21L16.65 16.65M11 8V14M8 11H14M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),t(w.div,{style:{position:"absolute",top:"50%",left:"50%",width:"30px",height:"30px",background:"radial-gradient(circle, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0) 70%)",transform:"translate(-50%, -50%)",pointerEvents:"none"},animate:{opacity:c,scale:u},transition:{type:"spring",stiffness:300,damping:20}})]}),o("div",{className:"relative flex-1 h-2 bg-gray-700 rounded-full overflow-hidden",children:[t(w.div,{className:"absolute top-0 left-0 h-full bg-blue-500 rounded-full",style:{boxShadow:"0 0 10px rgba(59,130,246,0.5)"},animate:{width:l},transition:{type:"spring",stiffness:300,damping:10,precision:.01}}),t("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:e,onChange:e=>r(parseFloat(e.target.value)),onMouseDown:()=>n(!0),onMouseUp:()=>n(!1),onTouchStart:()=>n(!0),onTouchEnd:()=>n(!1),className:"absolute top-0 left-0 w-full h-full opacity-0 cursor-pointer"})]}),o(w.div,{className:"relative",whileHover:{scale:1.2},whileTap:{scale:.95},onClick:()=>r(Math.min(2,e+.1)),children:[t(w.svg,{className:"text-gray-200 ml-3 cursor-pointer",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",whileHover:{rotate:90},transition:{duration:.3},children:t("path",{d:"M21 21L16.65 16.65M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),t(w.div,{style:{position:"absolute",top:"50%",left:"50%",width:"30px",height:"30px",background:"radial-gradient(circle, rgba(59,130,246,0.2) 0%, rgba(59,130,246,0) 70%)",transform:"translate(-50%, -50%)",pointerEvents:"none"},animate:{opacity:c,scale:u},transition:{type:"spring",stiffness:300,damping:20}})]})]})},nr=({onSearch:e,zoom:r,onZoomChange:i,isGrouped:n,onGroupToggle:a,viewMode:s,onViewModeChange:l})=>{const c=h(null);return d((()=>{const e=c.current;if(e){(()=>{const r=e.querySelector("path");if(r){const e=r.getTotalLength();r.style.strokeDasharray=`${e} ${e}`,r.style.strokeDashoffset=`${e}`,r.getBoundingClientRect(),r.style.transition="stroke-dashoffset 2s ease-in-out",r.style.strokeDashoffset="0"}})()}}),[]),o(w.div,{className:De,initial:{opacity:0,y:-50},animate:{opacity:1,y:0},transition:{duration:.5},children:[t("svg",{ref:c,className:Ve,children:t("path",{d:"M0,0 Q50,20 100,10 T200,30 T300,5 T400,25 V100 Q350,80 300,90 T200,70 T100,95 T0,75 Z"})}),o("div",{className:Oe,children:[t(Je,{})," ",t(or,{onSearch:e})]}),o("div",{className:Qe,children:[t("div",{className:Ye,children:Object.values(pe).map((e=>t(w.button,{onClick:()=>l(e),className:`${Ke} ${s===e?Xe:""}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:e.charAt(0).toUpperCase()+e.slice(1)},e)))}),t(w.button,{onClick:a,className:Ze,whileHover:{scale:1.05},whileTap:{scale:.95},children:n?"Ungroup":"Group"}),t(ir,{zoom:r,onZoomChange:i})]})]})};const ar={sidebar:"_sidebar_1d71g_2",logo:"_logo_1d71g_7",folderList:"_folderList_1d71g_12",folderItem:"_folderItem_1d71g_17",folderButton:"_folderButton_1d71g_22",selectedFolder:"_selectedFolder_1d71g_30",uploadButton:"_uploadButton_1d71g_35"},sr="loraFinderHomeDirectory",lr=()=>{try{return localStorage.getItem(sr)}catch(e){return console.error("Error reading home directory from localStorage:",e),null}},cr=({selectedFolder:e,onFolderChange:r})=>{const{data:i,isLoading:n,isError:a,error:l}=C({queryKey:["folders"],queryFn:X}),[c,u]=s(null);d((()=>{u(lr())}),[]);const h=(e,r)=>{r.stopPropagation(),(e=>{try{localStorage.setItem(sr,e)}catch(l){console.error("Error setting home directory in localStorage:",l)}})(e),u(e),console.log("Set home directory:",e)};return n?t(w.div,{initial:{x:-300},animate:{x:0},transition:{type:"spring",stiffness:120},className:`${ar.sidebar} ${ar.loading}`,children:"Loading folders..."}):a?o(w.div,{initial:{x:-300},animate:{x:0},transition:{type:"spring",stiffness:120},className:`${ar.sidebar} ${ar.error}`,children:["Error: ",(null==l?void 0:l.message)||"Failed to load folders"]}):t(w.div,{initial:{x:-300},animate:{x:0},transition:{type:"spring",stiffness:120},className:ar.sidebar,children:o("div",{className:`${ar.sidebar} flex flex-col h-full`,children:[t("div",{className:ar.logo,children:"Lora Finder"}),t("ul",{className:`${ar.folderList} flex-grow overflow-y-auto`,children:(i??[]).map((i=>t("li",{className:`${ar.folderItem} group`,children:o("button",{onClick:()=>{r(i.name)},className:`${ar.folderButton} ${e===i.name?ar.selectedFolder:""}`,children:[t("span",{className:ar.folderName,children:i.name}),t("button",{onClick:e=>h(i.name,e),className:`${ar.setHomeButton} ${i.name===c?ar.isHome:"opacity-0 group-hover:opacity-100"}`,title:`Set ${i.name} as home directory`,children:t(A,{})})]})},i.name)))}),t("div",{className:"p-8 mt-auto",children:t("button",{className:`${ar.uploadButton} w-full`,children:"Upload"})})]})})},ur="--scroll-y",hr="--mouse-x",dr="--mouse-y",gr={[ur]:"0px",[hr]:"0px",[dr]:"0px"};M.registerPlugin(G);const mr=({children:e,selectedFolder:r,onFolderChange:i,onSearch:n,zoom:a,onZoomChange:l,isGrouped:c,onGroupToggle:u,viewMode:h,onViewModeChange:g,mainRef:m})=>{d((()=>{function e(e){const r=e.clientX,t=e.clientY;document.documentElement.style.setProperty(hr,`${r}px`),document.documentElement.style.setProperty(dr,`${t}px`)}function r(){const e=window.scrollY;document.documentElement.style.setProperty(ur,`${e}px`)}return Object.entries(gr).forEach((([e,r])=>{document.documentElement.style.setProperty(e,r)})),window.addEventListener("scroll",r),document.addEventListener("mousemove",e),document.addEventListener("click",e),()=>{window.removeEventListener("scroll",r),document.removeEventListener("mousemove",e),document.removeEventListener("click",e)}}),[]);const[p,f]=s("");return t("div",{className:"flex flex-col h-screen relative bg-transparent",children:o(V,{children:[t("div",{className:"gradient-overlay"}),t(Ie,{}),t(nr,{onSearch:e=>{f(e),n(e)},zoom:a,onZoomChange:l,isGrouped:c,onGroupToggle:u,viewMode:h,onViewModeChange:g}),o("div",{className:"flex flex-1 overflow-hidden",children:[t(cr,{selectedFolder:r,onFolderChange:i}),t("main",{ref:m,className:"flex-1 overflow-auto p-4 relative bg-transparent",children:t("div",{className:"relative z-10",children:t(je,{selectedFolder:r,searchQuery:p,zoom:a,isGrouped:c,viewMode:h,scrollContainerRef:m})})})]})]})})},pr=()=>{const[e,r]=s((()=>lr()||"")),[o,i]=s(1),[n,a]=s(""),[l,c]=s(!0),[u,d]=s(pe.GRID),g=h(null);return t(mr,{selectedFolder:e,onFolderChange:e=>{r(e)},onSearch:e=>{a(e)},zoom:o,onZoomChange:e=>{i(e)},isGrouped:l,onGroupToggle:()=>{c((e=>!e))},viewMode:u,onViewModeChange:e=>{d(e)},mainRef:g,children:t(je,{zoom:o,searchQuery:n,selectedFolder:e,isGrouped:l,viewMode:u,scrollContainerRef:g})})};function fr(){return t("div",{className:"App",children:t(pr,{})})}function wr(){return{html:p.renderToString(t(n.StrictMode,{children:t(fr,{})}))}}export{wr as render};
//# sourceMappingURL=entry-server.js.map
